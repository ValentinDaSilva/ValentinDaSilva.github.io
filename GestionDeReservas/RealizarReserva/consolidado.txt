ğŸ“‚ Estructura del proyecto (.):
-----------------------------------
.
â”œâ”€â”€ consolidado.txt
â”œâ”€â”€ CSS
â”‚Â Â  â”œâ”€â”€ estados-habitaciones.css
â”‚Â Â  â”œâ”€â”€ estilos-base.css
â”‚Â Â  â”œâ”€â”€ filtro.css
â”‚Â Â  â”œâ”€â”€ fondo.css
â”‚Â Â  â”œâ”€â”€ formulario-reserva.css
â”‚Â Â  â”œâ”€â”€ modales.css
â”‚Â Â  â””â”€â”€ resultado.css
â”œâ”€â”€ Documentacion
â”‚Â Â  â””â”€â”€ DiagramaSecuencia.puml
â”œâ”€â”€ GestorReserva.js
â”œâ”€â”€ JS
â”‚Â Â  â”œâ”€â”€ datos-habitaciones.js
â”‚Â Â  â”œâ”€â”€ filtro-habitaciones.js
â”‚Â Â  â”œâ”€â”€ generar-tabla.js
â”‚Â Â  â”œâ”€â”€ gestor-realizar-reserva.js
â”‚Â Â  â”œâ”€â”€ HabitacionDAO.js
â”‚Â Â  â”œâ”€â”€ leyenda.js
â”‚Â Â  â”œâ”€â”€ modales.js
â”‚Â Â  â”œâ”€â”€ mostrar-json-reserva.js
â”‚Â Â  â”œâ”€â”€ ReservaDAO.js
â”‚Â Â  â”œâ”€â”€ reserva.js
â”‚Â Â  â”œâ”€â”€ seleccion-habitaciones.js
â”‚Â Â  â”œâ”€â”€ tabla-habitaciones.js
â”‚Â Â  â”œâ”€â”€ test.js
â”‚Â Â  â”œâ”€â”€ UIReservas.js
â”‚Â Â  â””â”€â”€ validaciones-campos.js
â””â”€â”€ realizarReserva.html

4 directories, 26 files

-----------------------------------

// [realizarReserva.html]
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Realizar Reserva - Hotel Premier</title>

  <!-- CSS -->
  <link rel="stylesheet" href="CSS/estilos-base.css">
  <link rel="stylesheet" href="CSS/fondo.css">
  <link rel="stylesheet" href="CSS/formulario-reserva.css">
  <link rel="stylesheet" href="CSS/resultado.css">
  <link rel="stylesheet" href="CSS/estados-habitaciones.css">
  <link rel="stylesheet" href="CSS/filtro.css">
  <link rel="stylesheet" href="CSS/modales.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
</head>

<body>
  <a href="javascript:volverPaginaAnterior()" class="enlace-volver">&#8592; Volver</a>

  <!-- FORMULARIO DE BÃšSQUEDA -->
  <div class="fondo-reserva">
    <div class="formulario-busqueda">
      <h2 class="titulo-formulario">Habitaciones Disponibles</h2>
      <form novalidate>
        <label for="fecha-desde" class="etiqueta-campo requerido">Desde fecha</label>
        <input type="date" id="fecha-desde" class="campo-fecha" required>

        <label for="fecha-hasta" class="etiqueta-campo requerido">Hasta fecha</label>
        <input type="date" id="fecha-hasta" class="campo-fecha" required>

        <button type="submit" class="boton-buscar">Buscar</button>
      </form>
    </div>
  </div>

  <!-- RESULTADOS -->
  <div class="contenedor-resultados animate__animated animate__fadeIn" style="display: none;">
    <img src="/assets/image/Pregunta.png" alt="info" class="icono-informacion">

    <div id="contenedor-filtro" class="contenedor-filtro" style="display: none;">
      <label class="etiqueta-filtro">Filtrar:</label>
      <select id="filtro-tipo-habitacion" class="select-filtro">
        <option value="">Todos</option>
        <option value="IND">IND</option>
        <option value="DOBE">DOBE</option>
        <option value="DOBS">DOBS</option>
        <option value="FAM">FAM</option>
        <option value="SUITE">SUITE</option>
      </select>
    </div>

    <h2 class="titulo-resultados">Resultados de la bÃºsqueda</h2>

    <div class="contenedor-tabla-scroll">
      <table class="tabla-habitaciones">
        <thead></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="boton-reservar">Reservar</div>
  </div>

  <!-- MODALES -->
  <div id="modal-error" class="modal" style="display: none;">
    <div class="contenido-modal-error">
      <h2 class="titulo-error">ERROR</h2>
      <img src="/assets/image/Error.png" class="imagen-modal">
      <p id="mensaje-error" class="mensaje-modal">Mensaje</p>
      <button id="boton-ok" class="boton-ok">OKğŸ‘</button>
    </div>
  </div>

  <div id="modal-correcto" class="modal" style="display: none;">
    <div class="contenido-modal-correcto">
      <h2 class="titulo-correcto">Ã‰XITO</h2>
      <img src="/assets/image/Correcto.png" class="imagen-modal">
      <p id="mensaje-correcto" class="mensaje-modal"></p>
    </div>
  </div>

  <div id="modal-advertencia" class="modal" style="display: none;">
    <div class="contenido-modal-advertencia">
      <h2 class="titulo-advertencia">ADVERTENCIA</h2>
      <img src="/assets/image/Advertencia.png" class="imagen-modal">
      <p id="mensaje-advertencia" class="mensaje-modal"></p>
      <div class="botones-advertencia">
        <button id="boton-advertencia-aceptar" class="boton-advertencia boton-advertencia-aceptar">ACEPTAR</button>
        <button id="boton-advertencia-corregir" class="boton-advertencia boton-advertencia-corregir">CORREGIR</button>
      </div>
    </div>
  </div>

  <!-- ============================================================ -->
  <!--                     SCRIPTS                                  -->
  <!-- ============================================================ -->

  <!-- Login -->
  <script src="/Login/JS/validar-sesion.js"></script>
  <script src="/Login/JS/navegacion-volver.js"></script>

  <!-- Modales -->
  <script src="JS/modales.js"></script>

  <!-- Backend real: habitaciones + reservas -->
  <script src="JS/datos-habitaciones.js"></script>

  <!-- ValidaciÃ³n fechas -->
  <script src="JS/validaciones-campos.js"></script>

  <!-- Estilos de la tabla -->
  <script src="JS/tabla-habitaciones.js"></script>

  <!-- Filtro -->
  <script src="JS/filtro-habitaciones.js"></script>

  <!-- Generar tabla -->
  <script src="JS/generar-tabla.js"></script>

  <!-- SelecciÃ³n de habitaciones -->
  <script src="JS/seleccion-habitaciones.js"></script>

  <!-- Leyenda -->
  <script src="JS/leyenda.js"></script>

  <!-- Mostrar JSON (si lo usÃ¡s para debug) -->
  <script src="JS/mostrar-json-reserva.js"></script>

  <!-- Test (ALT+P) -->
  <script src="JS/test.js"></script>

  <!-- DAO + Gestor + UI (MÃ“DULOS) -->
  <script type="module" src="JS/UIReservas.js"></script>
</body>
</html>



// [CSS/estados-habitaciones.css]


.estado-libre {
  background-color: rgb(145, 190, 153);
}

.estado-ocupada {
  background-color: rgb(215, 148, 163);
}

.estado-reservada {
  background-color: rgb(215, 198, 126);
}

.estado-fuera-servicio {
  background-color: rgb(148, 150, 152);
}

.estado-seleccionada {
  background-color: yellow;
}



.caja-color {
  width: 20px;
  height: 20px;
  margin-right: 5px;
}

.color-libre {
  background-color: rgb(195, 230, 203);
  border: 1px solid #155724;
}

.color-ocupada {
  background-color: rgb(245, 198, 203);
  border: 1px solid #721c24;
}

.color-reservada {
  background-color: rgb(255, 238, 186);
  border: 1px solid #856404;
}

.color-seleccionada {
  background-color: yellow;
  border: 1px solid #856404;
}

.color-fuera-servicio {
  background-color: rgb(198, 200, 202);
  border: 1px solid #383d41;
}

.item-leyenda {
  display: flex;
  align-items: center;
  margin-bottom: 5px;
}

.contenedor-leyenda {
  padding: 10px;
}

.contenedor-leyenda > * {
  margin-bottom: 10px;
}

.icono-cerrar {
  position: absolute;
  top: 5px;
  right: 15px;
  width: 40px;
  height: 40px;
  font-size: 36px;
  color: #64443a;
  cursor: pointer;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: center;
}




// [CSS/estilos-base.css]


* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: sans-serif;
}

body, html {
  height: 100%;
}




// [CSS/filtro.css]


.contenedor-filtro {
    position: absolute;
    bottom: 30px;
    left: 20px;
    z-index: 3;
    display: flex !important;
    align-items: center;
    gap: 8px;
    width: 20px;
}

.etiqueta-filtro {
  font-weight: bold;
  color: #333;
  font-size: 14px;
}

.select-filtro {
  padding: 6px 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
  background-color: white;
  font-size: 13px;
  cursor: pointer;
  min-width: 100px;
}

.select-filtro:hover {
  border-color: #412c26;
}

.select-filtro:focus {
  outline: none;
  border-color: #412c26;
  box-shadow: 0 0 5px rgba(65, 44, 38, 0.3);
}




// [CSS/fondo.css]


.fondo-reserva {
  background-image: url('/assets/image/fondoAltaHuesped.webp');
  background-size: cover;
  background-position: center;
  height: 100vh;
  padding-left: 50px;
  position: relative;
}

.fondo-reserva.opaco::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.616);
  opacity: 1;
  z-index: 1;
}

.fondo-reserva > * {
  position: relative;
  z-index: 2;
}

.enlace-volver {
    position: fixed;
    bottom: 20px;
    left: 20px;
    text-decoration: none;
    font-size: 24px;
    color: #64443a;
    z-index: 1000;
    background-color: rgba(255, 255, 255, 0.8);
    padding: 10px 15px;
    border-radius: 8px;
    transition: background-color 0.3s ease;
}

.enlace-volver:hover {
    background-color: rgba(255, 255, 255, 1);
}




// [CSS/formulario-reserva.css]


.formulario-busqueda {
  background-color: rgba(255, 255, 255, 0.85);
  padding: 30px 25px;
  border-radius: 8px;
  width: 250px;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  transform: translateY(-10px);
}

.titulo-formulario {
  margin-bottom: 20px;
  font-size: 20px;
  text-align: center;
}

.etiqueta-campo {
  display: block;
  margin-bottom: 5px;
  font-size: 14px;
}

.etiqueta-campo.requerido::after {
  content: "*";
  color: red;
  margin-left: 5px;
}

.campo-fecha {
  width: 100%;
  padding: 8px;
  margin-bottom: 15px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

.boton-buscar {
  width: 100%;
  padding: 10px;
  background-color: black;
  color: white;
  border: none;
  border-radius: 4px;
  font-weight: bold;
  cursor: pointer;
}

.boton-buscar:hover {
  background-color: #333;
}




// [CSS/modales.css]


.modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  justify-content: center;
  align-items: center;
}

.contenido-modal-error {
  background-color: #fff;
  padding: 20px;
  border-radius: 10px;
  width: 80%;
  max-width: 400px;
  text-align: center;
}

.titulo-error {
  text-align: center;
  color: #d32f2f;
  font-size: 24px;
  margin-top: 10px;
}

.imagen-modal {
  height: 30%;
  display: block;
  margin: 0 auto;
}

.mensaje-modal {
  text-align: center;
  margin-top: 20px;
}

.boton-ok {
  display: block;
  margin: 20px auto 0;
  padding: 10px 20px;
  background-color: #d32f2f;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
}

.boton-ok:hover {
  background-color: #b71c1c;
}

.contenido-modal-correcto {
  background-color: #fff;
  padding: 20px;
  border-radius: 10px;
  width: 80%;
  max-width: 400px;
  text-align: center;
  height: 60%;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.titulo-correcto {
  text-align: center;
  color: #2fd345;
  font-size: 24px;
  margin-top: 10px;
}

.contenido-modal-advertencia {
  background-color: #fff;
  padding: 20px;
  border-radius: 10px;
  width: 80%;
  max-width: 400px;
  text-align: center;
}

.titulo-advertencia {
  text-align: center;
  color: yellow;
  font-size: 24px;
  margin-top: 10px;
}

.botones-advertencia {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  gap: 10px;
  padding: 0 20px;
}

.boton-advertencia {
  display: block;
  margin: 20px auto 0;
  padding: 10px 20px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
}

.boton-advertencia-aceptar {
  background-color: #d32f2f;
  color: white;
}

.boton-advertencia-aceptar:hover {
  background-color: #b71c1c;
}

.boton-advertencia-corregir {
  background-color: #2fd345;
  color: white;
}

.boton-advertencia-corregir:hover {
  background-color: #28c038;
}



.contenedor-confirmacion {
  display: flex;
  flex-direction: column;
  align-items: center;
}


.titulo-formulario-huesped,
.formulario-datos-huesped + h2,
.contenedor-confirmacion h2 {
  color: #49312a;
  font-size: 28px;
  margin-bottom: 30px;
  text-align: center;
  font-weight: 700;
}


.formulario-datos-huesped {
  width: 100%;
  max-width: 800px;
  background-color: rgba(255, 255, 255, 0.95);
  padding: 40px;
  border-radius: 15px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
  margin: 20px auto;
}

.cuadricula-formulario-huesped {
  display: grid;
  grid-template-columns: 1fr;
  gap: 25px;
  margin-bottom: 30px;
}

.contenedor-campo-huesped {
  position: relative;
  width: 100%;
}

.contenedor-campo-huesped label {
  display: block;
  margin-bottom: 8px;
  color: #49312a;
  font-weight: 600;
  font-size: 14px;
  text-align: left;
}

.contenedor-campo-huesped .campo-huesped {
  width: 100%;
  padding: 12px 40px 12px 15px;
  border: 2px solid #a1887f;
  border-radius: 8px;
  font-size: 16px;
  background-color: #fffaf4;
  transition: all 0.3s ease;
  outline: none;
}

.contenedor-campo-huesped .campo-huesped:focus {
  border-color: #6d4c41;
  background-color: #ffffff;
  box-shadow: 0 0 0 3px rgba(109, 76, 65, 0.1);
}

.contenedor-campo-huesped .campo-huesped.campo-valido {
  border-color: #2fd345;
  background-color: #f0fff4;
}

.contenedor-campo-huesped .campo-huesped.campo-valido:focus {
  box-shadow: 0 0 0 3px rgba(47, 211, 69, 0.1);
}

.contenedor-campo-huesped .campo-huesped.campo-invalido {
  border-color: #d32f2f;
  background-color: #fff5f5;
}

.contenedor-campo-huesped .campo-huesped.campo-invalido:focus {
  box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);
}

.contenedor-campo-huesped .campo-huesped::placeholder {
  color: #a1887f;
  opacity: 0.7;
}

.mensaje-error {
  display: block;
  color: #d32f2f;
  font-size: 12px;
  margin-top: 5px;
  text-align: left;
  min-height: 18px;
  font-weight: 500;
}

.icono-validacion {
  position: absolute;
  right: 12px;
  top: 38px;
  font-size: 18px;
  font-weight: bold;
  pointer-events: none;
  transition: all 0.3s ease;
}

.icono-validacion-exito {
  color: #2fd345;
}

.icono-validacion-error {
  color: #d32f2f;
}

.boton-confirmar {
  background: linear-gradient(135deg, #6d4c41 0%, #8d6e63 100%);
  color: white;
  padding: 14px 40px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  width: 100%;
  max-width: 300px;
  
  display: block;
  position: relative;
  z-index: 1;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(109, 76, 65, 0.3);
}

.boton-confirmar:hover {
  background: linear-gradient(135deg, #8d6e63 0%, #6d4c41 100%);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(109, 76, 65, 0.4);
}

.boton-confirmar:active {
  transform: translateY(0);
  box-shadow: 0 2px 10px rgba(109, 76, 65, 0.3);
}

.boton-confirmar:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.boton-aceptar-reserva {
  position: absolute;
  left: calc(70% - 20px);
  bottom: 0;
}

.boton-rechazar-reserva {
  position: absolute;
  left: calc(70% - 20px - 30% - 10px);
  bottom: 0;
}

.contenedor-habitacion-reserva {
  text-align: center;
  border: 2px solid black;
  padding: 10px;
  margin-bottom: 10px;
}




// [CSS/resultado.css]
.contenedor-resultados {
  width: 60vw;
  height: 80vh;
  margin: 50px;
  background-color: #fff;
  border-radius: 8px;
  box-shadow: 20px 20px 20px rgba(0, 0, 0, 0.4);
  border: 2px solid #6b493ed0;
  position: absolute;
  top: 50px;
  left: 300px;
  padding: 20px;
  z-index: 2;
}

.titulo-resultados {
  text-align: center;
  color: #333;
  height: 10%;
  margin: 0;
}

.contenedor-tabla-scroll {
  overflow: auto;
  border: 1px solid #ccc;
  height: 80%;
  position: relative;
}

.tabla-habitaciones {
  width: 100%;
  border-collapse: collapse;
  min-width: 100%;
}

.tabla-habitaciones th,
.tabla-habitaciones td {
  padding: 12px;
  border-bottom: 1px solid #ddd;
  text-align: center;
  color: black;
  white-space: nowrap;
  border: 1px solid black;
}

.tabla-habitaciones th {
  background-color: #412c26;
  font-weight: bold;
  color: white;
  cursor: pointer;
}

.tabla-habitaciones thead th {
  position: sticky;
  top: 0;
  z-index: 10;
  background-color: #412c26;
}

.tabla-habitaciones th:first-child,
.tabla-habitaciones td:first-child {
  position: sticky;
  left: 0;
  z-index: 9;
  background-color: #412c26;
  color: white;
}

.tabla-habitaciones td:first-child {
  background-color: white !important;
  color: black;
  border-right: 2px solid #ddd;
  font-weight: bold;
}

.tabla-habitaciones thead th:first-child {
  z-index: 11;
}

.tabla-habitaciones td.estado-seleccionada {
  position: relative;
  z-index: 1;
}

.tabla-habitaciones td.estado-seleccionada:first-child {
  z-index: 10;
  background-color: white !important;
}

.tabla-habitaciones tr:hover {
  background-color: #f9f9f9;
}

.boton-reservar {
  width: 30%;
  background-color: #412c26;
  color: white;
  padding: 12px;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  cursor: pointer;
  text-align: center;
  position: relative;
  left: calc(70% - 10px);
  bottom: 0;
  margin: 10px;
}

.boton-reservar:hover {
  background-color: #5a3d33;
}

.icono-informacion {
  position: absolute;
  top: 5px;
  right: 15px;
  width: 50px;
  height: 50px;
  cursor: pointer;
}

/* ============================================= */
/*  NUEVO: estilo idÃ©ntico al botÃ³n Reservar     */
/* ============================================= */
.boton-reserva-estandar {
  background-color: #412c26;
  color: white;
  padding: 12px 20px;
  border: none;
  border-radius: 4px;
  font-size: 16px;
  cursor: pointer;
  text-align: center;
  margin: 10px auto;
  display: inline-block;
  min-width: 180px;
}

.boton-reserva-estandar:hover {
  background-color: #5a3d33;
}

/* Scrollbars */
::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: rgba(0, 0, 0, 0.4);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 0, 0, 0.6);
}

/* Caja general de la leyenda */
.leyenda-box {
  font-family: sans-serif;
}

/* Fieldset con borde suave */
.leyenda-section {
  padding: 20px;
  border-radius: 10px;
  border: 2px solid #412c26;
  margin-top: 10px;
}

/* Texto principal */
.leyenda-section h3 {
  color: #412c26;
  margin-bottom: 10px;
}

/* Ãtems */
.item-leyenda {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 6px;
  font-size: 15px;
}

/* Cajitas de color */
.caja-color {
  width: 22px;
  height: 22px;
  border-radius: 4px;
  border: 1px solid #333;
}

/* Colores de la leyenda (coinciden con la tabla real) */
.color-libre {
  background-color: rgb(195, 230, 203);
  border-color: #155724;
}

.color-ocupada {
  background-color: rgb(245, 198, 203);
  border-color: #721c24;
}

.color-reservada {
  background-color: rgb(255, 238, 186);
  border-color: #856404;
}

.color-seleccionada {
  background-color: yellow;
  border-color: #856404;
}

.color-fuera-servicio {
  background-color: rgb(198, 200, 202);
  border-color: #383d41;
}



// [GestorReserva.js]
// GestorReserva.js
// =======================================================
// GestorReserva
//  - Valida rango de fechas
//  - Obtiene estado de habitaciones (HabitacionDAO, ReservaDAO)
//  - Crea reservas (dominio + DTO)
//  - Llama a ReservaDAO para guardar
// =======================================================

import { HabitacionDAO } from "./JS/HabitacionDAO.js";
import { ReservaDAO } from "./JS/ReservaDAO.js";

class GestorReserva {

  // ---------------------------------------------------
  // Validar rango de fechas
  // ---------------------------------------------------
  static validarRangoFechas(desde, hasta, ui) {
    if (!desde || !hasta) {
      ui.mostrarError("Debes completar ambas fechas.");
      return false;
    }

    const d1 = new Date(desde);
    const d2 = new Date(hasta);

    if (d1 >= d2) {
      ui.mostrarError("La fecha de salida debe ser posterior a la de entrada.");
      const checkinInput = document.getElementById("fecha-desde");
      const checkoutInput = document.getElementById("fecha-hasta");
      if (checkinInput) checkinInput.value = "";
      if (checkoutInput) checkoutInput.value = "";
      if (checkinInput) checkinInput.focus();
      return false;
    }

    if (typeof limpiarHabitacionesSeleccionadas === "function") {
      limpiarHabitacionesSeleccionadas();
    }

    return true;
  }

  // ---------------------------------------------------
  // Obtener estado de habitaciones (CU05)
  // ---------------------------------------------------
  static async obtenerEstadoHabitaciones(desde, hasta, ui) {
    console.log("ğŸ” Obteniendo estado de habitaciones entre", desde, "y", hasta);
    try {
      let listaReservas = await HabitacionDAO.listarHabitaciones();

      let listarHabitaciones = await ReservaDAO.buscarReservasEntre(desde, hasta);
      let huboLibre = false; 
      if (typeof generarTablaHabitaciones === "function") {
          huboLibre = generarTablaHabitaciones(desde, hasta);
      }
      if(huboLibre === false){
        ui.mostrarError("No hay habitaciones disponibles en el rango de fechas seleccionado.");
        return;
      }
      ui.mostrarGrilla();

    } catch (error) {
      console.error("âŒ Error en obtenerEstadoHabitaciones():", error);
      ui.mostrarError("No se pudo mostrar el estado de las habitaciones.");
    }

  }

  // ---------------------------------------------------
  // Crear reserva (CU04)
  // listaSeleccion = [{ habitacion: "IND-101", fechaDesde, fechaHasta }]
  // ---------------------------------------------------
  static async crearReserva(listaSeleccion, titular, desde, hasta, ui) {
    try {
      if (!Array.isArray(listaSeleccion) || listaSeleccion.length === 0) {
        ui.mostrarError("Debe seleccionar al menos una habitaciÃ³n.");
        return;
      }

      if (!titular || !titular.nombre || !titular.apellido || !titular.telefono) {
        ui.mostrarError("Debe completar los datos obligatorios del titular.");
        return;
      }

      const seleccionNormalizada = GestorReserva.extraerDatosSeleccion(listaSeleccion);
      const reservasDominio = GestorReserva.crearReservaDominio(seleccionNormalizada, titular);
      const reservasDTO = GestorReserva.crearReservaDTO(reservasDominio);

      await GestorReserva.guardarEnBD(reservasDTO);

      ui.mostrarReservaExitosa();

    } catch (error) {
      console.error("âŒ Error en crearReserva():", error);
      ui.mostrarError("No se pudo completar la reserva: " + error.message);
    }
  }

  // ---------------------------------------------------
  // Helpers internos (sin guiones bajos en el nombre)
  // ---------------------------------------------------
  static extraerDatosSeleccion(listaSeleccion) {
    return listaSeleccion.map(item => {
      const { habitacion, fechaDesde, fechaHasta } = item || {};

      if (!habitacion || !fechaDesde || !fechaHasta) {
        throw new Error("La selecciÃ³n de habitaciones es invÃ¡lida.");
      }

      const numero = GestorReserva.extraerNumero(habitacion);
      if (numero === null) {
        throw new Error(`No se pudo obtener el nÃºmero de habitaciÃ³n desde "${habitacion}".`);
      }

      return {
        habitacion,
        numero,
        fechaDesde,
        fechaHasta
      };
    });
  }

  static crearReservaDominio(seleccionNormalizada, titular) {
    const titularDominio = {
      nombre: titular.nombre,
      apellido: titular.apellido,
      telefono: titular.telefono
    };

    return seleccionNormalizada.map(sel => ({
      fechaInicio: sel.fechaDesde,
      fechaFin: sel.fechaHasta,
      titular: titularDominio,
      estado: "PENDIENTE",
      habitaciones: [
        { numero: sel.numero }
      ]
    }));
  }

  static crearReservaDTO(reservasDominio) {
    if (!Array.isArray(reservasDominio) || reservasDominio.length === 0) {
      throw new Error("No hay reservas en el modelo de dominio.");
    }

    return reservasDominio.map(r => ({
      fechaInicio: r.fechaInicio,
      fechaFin: r.fechaFin,
      titular: {
        nombre: r.titular.nombre,
        apellido: r.titular.apellido,
        telefono: r.titular.telefono
      },
      habitaciones: r.habitaciones.map(h => ({
        numero: h.numero
      }))
    }));
  }

  static async guardarEnBD(reservasDTO) {
    if (!Array.isArray(reservasDTO) || reservasDTO.length === 0) {
      throw new Error("No hay reservas para guardar.");
    }

    for (const reserva of reservasDTO) {
      await ReservaDAO.guardarReserva(reserva);
    }
  }

  static extraerNumero(nombreHabitacion) {
    if (typeof obtenerNumeroDesdeNombre === "function") {
      return obtenerNumeroDesdeNombre(nombreHabitacion);
    }

    const partes = (nombreHabitacion || "").split("-");
    const num = parseInt(partes[1]);
    return isNaN(num) ? null : num;
  }
}

export { GestorReserva };
window.GestorReserva = GestorReserva;



// [JS/datos-habitaciones.js]
// [JS/datos-habitaciones.js]
// ===========================================================
//   datos-habitaciones.js â€” VERSIÃ“N FINAL DEFINITIVA
//   âœ” NormalizaciÃ³n consistente (tipo + categorÃ­a)
//   âœ” Sin timezone (no usa new Date())
//   âœ” Compatible 100% con filtros y selecciÃ³n
//   âœ” Regenera fechas y estados correctamente
// ===========================================================

// Estado interno
let HABITACIONES = [];
let RESERVAS = [];
let datosHabitacionesCargados = false;

// ===========================================================
//   NormalizaciÃ³n REAL segÃºn backend
// ===========================================================
function normalizarTipo(h) {
  if (!h || !h.tipo) return "";

  const tipo = h.tipo.trim().toLowerCase();
  const categoria = (h.categoria || "").trim().toLowerCase();

  // Individual
  if (tipo === "individual") return "IND";

  // Doble estÃ¡ndar
  if (tipo === "doble" && categoria.includes("estandar")) return "DOBE";
  if (tipo === "doble" && categoria.includes("estÃ¡ndar")) return "DOBE";

  // Doble superior
  if (tipo === "doble" && categoria.includes("superior")) return "DOBS";

  // Familiar
  if (tipo === "familiar") return "FAM";

  // Suite
  if (tipo === "suite") return "SUITE";

  return "";
}

window.normalizarTipo = normalizarTipo;

// ===========================================================
//   Comparar fechas YYYY-MM-DD (sin Date())
// ===========================================================
function compararFechas(f1, f2) {
  const A = f1.split("-").map(Number);
  const B = f2.split("-").map(Number);

  if (A[0] !== B[0]) return A[0] - B[0];
  if (A[1] !== B[1]) return A[1] - B[1];
  return A[2] - B[2];
}

// ===========================================================
//   Generar array de fechas (sin timezone)
// ===========================================================
function generarArrayFechas(inicio, fin) {
  const [y1, m1, d1] = inicio.split("-").map(Number);
  const [y2, m2, d2] = fin.split("-").map(Number);

  let y = y1, m = m1, d = d1;
  const fechas = [];

  while (true) {
    fechas.push(`${y}-${String(m).padStart(2, "0")}-${String(d).padStart(2, "0")}`);

    if (y === y2 && m === m2 && d === d2) break;

    d++;

    const diasMes = new Date(y, m, 0).getDate();
    if (d > diasMes) {
      d = 1;
      m++;
      if (m > 12) {
        m = 1;
        y++;
      }
    }
  }

  return fechas;
}

// ===========================================================
//   Formatear fecha dd/mm/yyyy
// ===========================================================
function formatearFecha(f) {
  const [y, m, d] = f.split("-");
  return `${d}/${m}/${y}`;
}

// ===========================================================
//   GET /api/habitaciones
// ===========================================================
async function cargarHabitaciones() {
   
}

async function asegurarHabitaciones() {
  if (!datosHabitacionesCargados || HABITACIONES.length === 0) {
    await cargarHabitaciones();
  }
}


// ===========================================================
//   Consultas globales
// ===========================================================
function obtenerHabitaciones() {
  return HABITACIONES;
}

function obtenerReservas() {
  return RESERVAS;
}

// HabitaciÃ³n reservada?
function estaHabitacionReservada(numero, fechaISO) {
  return RESERVAS.some(r =>
    r.habitaciones?.some(h => h.numero === numero) &&
    compararFechas(fechaISO, r.fechaInicio) >= 0 &&
    compararFechas(fechaISO, r.fechaFin) <= 0
  );
}

// Obtener nÃºmero desde "IND-101"
function obtenerNumeroDesdeNombre(nombre) {
  const partes = nombre.split("-");
  const num = parseInt(partes[1]);
  return isNaN(num) ? null : num;
}

// Exponer funciones globales
window.obtenerHabitaciones = obtenerHabitaciones;
window.obtenerReservas = obtenerReservas;
window.estaHabitacionReservada = estaHabitacionReservada;
window.obtenerNumeroDesdeNombre = obtenerNumeroDesdeNombre;

window.compararFechas = compararFechas;
window.generarArrayFechas = generarArrayFechas;
window.formatearFecha = formatearFecha;

window.asegurarHabitaciones = asegurarHabitaciones;
window.cargarReservasEntre = cargarReservasEntre;






// [JS/filtro-habitaciones.js]
// ====================================================
//    filtro-habitaciones.js â€” versiÃ³n FINAL DEFINITIVA
// ====================================================

// Lista completa de habitaciones (sin filtrar)
let TODAS_LAS_HABITACIONES = [];

// Valor del filtro actual seleccionado
let TIPO_FILTRO = "";

// =======================================================
// NORMALIZACIÃ“N DEFINITIVA (tipo + categorÃ­a)
// Convierte lo que viene del backend â†’ IND / DOBE / DOBS / FAM / SUITE
// =======================================================
function normalizarTipo(h) {
  if (!h || !h.tipo) return "";

  const tipo = h.tipo.trim().toLowerCase();
  const categoria = (h.categoria || "").trim().toLowerCase();

  // Individual
  if (tipo === "individual") return "IND";

  // Doble estÃ¡ndar
  if (tipo === "doble" && categoria.includes("estandar")) return "DOBE";
  if (tipo === "doble" && categoria.includes("estÃ¡ndar")) return "DOBE";

  // Doble superior
  if (tipo === "doble" && categoria.includes("superior")) return "DOBS";

  // Familiar (Family Plan)
  if (tipo === "familiar") return "FAM";

  // Suite
  if (tipo === "suite") return "SUITE";

  return "";
}

// =======================================================
// Guardamos TODAS las habitaciones crudas del backend
// =======================================================
function establecerHabitaciones(lista) {
  TODAS_LAS_HABITACIONES = Array.isArray(lista) ? lista : [];
}

// =======================================================
// FILTRO POR CÃ“DIGO (IND / DOBE / DOBS / FAM / SUITE)
// =======================================================
function filtrarHabitacionesPorTipo(tipoSeleccionado) {
  if (!tipoSeleccionado) return TODAS_LAS_HABITACIONES;

  return TODAS_LAS_HABITACIONES.filter(h => {
    const codigo = normalizarTipo(h);
    return codigo === tipoSeleccionado;
  });
}

function obtenerTipoFiltroActual() {
  return TIPO_FILTRO;
}

function establecerTipoFiltro(tipo) {
  TIPO_FILTRO = tipo;
}

// =======================================================
// Mostrar / ocultar filtro
// =======================================================
function mostrarFiltro() {
  const box = document.getElementById("contenedor-filtro");
  if (box) box.style.display = "flex";
}

function ocultarFiltro() {
  const box = document.getElementById("contenedor-filtro");
  if (box) box.style.display = "none";
}

// =======================================================
// Inicializar <select>
// =======================================================
function inicializarFiltro() {
  const select = document.getElementById("filtro-tipo-habitacion");
  if (!select) return;

  select.addEventListener("change", () => {
    establecerTipoFiltro(select.value);

    const f1 = document.getElementById("fecha-desde").value;
    const f2 = document.getElementById("fecha-hasta").value;

    if (f1 && f2) {
      generarTablaHabitaciones(f1, f2);
    }
  });
}

if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", inicializarFiltro);
} else {
  inicializarFiltro();
}

// =======================================================
// EXPONER A WINDOW
// =======================================================
window.establecerHabitaciones = establecerHabitaciones;
window.filtrarHabitacionesPorTipo = filtrarHabitacionesPorTipo;
window.obtenerTipoFiltroActual = obtenerTipoFiltroActual;
window.establecerTipoFiltro = establecerTipoFiltro;
window.mostrarFiltro = mostrarFiltro;
window.ocultarFiltro = ocultarFiltro;
window.normalizarTipo = normalizarTipo;




// [JS/generar-tabla.js]
// [JS/generar-tabla.js]
// ========================================================
//   generar-tabla.js â€” VERSIÃ“N FINAL ULTRA CORREGIDA
//   âœ” Soporta estados: libre / reservada / ocupada / fuera de servicio
//   âœ” Ordena habitaciones por tipo normalizado + nÃºmero
//   âœ” Respeta filtros
//   âœ” No pierde habitaciones duplicadas
// ========================================================

function generarTablaHabitaciones(fechaInicio, fechaFin) {
  const tabla = document.querySelector(".tabla-habitaciones");
  if (!tabla) {
    console.error("Tabla de habitaciones no encontrada");
    return;
  }

  const thead = tabla.querySelector("thead");
  const tbody = tabla.querySelector("tbody");

  if (!thead || !tbody) {
    console.error("thead o tbody no encontrados");
    return;
  }

  // ----------------------------------------
  // 1) Obtener habitaciones del backend
  // ----------------------------------------
  let habitaciones = obtenerHabitaciones() || [];

  // GUARDAR COPIA GLOBAL PARA EL FILTRO
  establecerHabitaciones(habitaciones);

  // Aplicar el filtro seleccionado
  const tipoFiltro = obtenerTipoFiltroActual();
  if (tipoFiltro) {
    habitaciones = filtrarHabitacionesPorTipo(tipoFiltro);
  }

    // Normalizar cada habitaciÃ³n â†’ agregar codigoTipo
  habitaciones = habitaciones.map(h => ({
    ...h,
    codigoTipo: normalizarTipo(h) // IND / DOBE / DOBS / FAM / SUITE
  }));

  // =====================================================
  // ORDENAR HABITACIONES SOLO POR NÃšMERO
  // =====================================================
  habitaciones.sort((a, b) => {
    const numA = Number(a.numero);
    const numB = Number(b.numero);

    if (isNaN(numA) || isNaN(numB)) {
      return String(a.numero).localeCompare(String(b.numero));
    }

    return numA - numB;
  });


  // Crear rango de fechas
  const fechas = generarArrayFechas(fechaInicio, fechaFin);

  // LIMPIAR tabla
  thead.innerHTML = "";
  tbody.innerHTML = "";

  if (!habitaciones.length || !fechas.length) return;

  // ----------------------------------------
  // 2) CABECERA
  // ----------------------------------------
  const headerRow = document.createElement("tr");

  const thFecha = document.createElement("th");
  thFecha.textContent = "Fecha \\ HabitaciÃ³n";
  headerRow.appendChild(thFecha);

  habitaciones.forEach(h => {
    const th = document.createElement("th");

    // TEXTO FINAL: "IND-103"
    th.textContent = `${h.codigoTipo}-${h.numero}`;
    th.dataset.tipoHabitacion = h.codigoTipo;

    headerRow.appendChild(th);
  });

  thead.appendChild(headerRow);

  // Mostrar filtro
  mostrarFiltro();

  // ----------------------------------------
  // 3) FILAS POR FECHA
  // ----------------------------------------
  fechas.forEach(fechaISO => {
    const fila = document.createElement("tr");

    // Celda de fecha
    const tdFecha = document.createElement("td");
    tdFecha.textContent = formatearFecha(fechaISO);
    fila.appendChild(tdFecha);

    habitaciones.forEach(h => {
      const td = document.createElement("td");

      // ==============================================
      // NORMALIZAR ESTADO DEL BACKEND
      // ==============================================
      let estadoBase = (h.estado || "")
        .trim()
        .toLowerCase()
        .replace(/\s+/g, "")
        .replace(/_/g, "")
        .replace(/-/g, "");

      // ==============================================
      // ESTADOS PRIORITARIOS
      // ==============================================
      if (estadoBase === "ocupada") {
        td.className = "estado-ocupada";
        td.dataset.estadoOriginal = "ocupada";

      } else if (estadoBase === "fueradeservicio") {
        td.className = "estado-fuera-servicio";
        td.dataset.estadoOriginal = "fuera-servicio";

      } else {
        // ==============================================
        // ESTADO POR RESERVAS EXISTENTES
        // ==============================================
        if (estaHabitacionReservada(h.numero, fechaISO)) {
          td.className = "estado-reservada";
          td.dataset.estadoOriginal = "reservada";
        } else {
          td.className = "estado-libre";
          td.dataset.estadoOriginal = "libre";
        }
      }

      td.dataset.numeroHabitacion = h.numero;
      td.dataset.fecha = fechaISO;

      fila.appendChild(td);
    });

    tbody.appendChild(fila);
  });

  // ----------------------------------------
  // 4) Estilado + selecciÃ³n
  // ----------------------------------------
  aplicarEstilosCeldas();
  inicializarSeleccionHabitaciones();
}

// Exponer globalmente
window.generarTablaHabitaciones = generarTablaHabitaciones;



// [JS/gestor-realizar-reserva.js]
// [JS/gestor-realizar-reserva.js]
// ===============================================================
//   GestorRealizarReserva â€” ejecutor del caso de uso Reservar
//   âœ” Valida y normaliza la selecciÃ³n de habitaciones
//   âœ” Crea el modelo de dominio interno
//   âœ” Crea el/los DTO para el backend
//   âœ” Hace las llamadas fetch y actualiza la UI
// ===============================================================

export class GestorRealizarReserva {

  static validaarFechas(desde, hasta) {
    const fechaDesde = new Date(desde);
    const fechaHasta = new Date(hasta);
    if (!desde || !hasta) {
          mensajeError("Debes completar ambas fechas.");
          return false;
        }

        if (new Date(desde) >= new Date(hasta)) {
          mensajeError("La fecha de salida debe ser posterior a la de entrada.");
          return false;
        }

        // Limpio selecciÃ³n anterior, cargo datos y genero grilla
        if (typeof limpiarHabitacionesSeleccionadas === "function") {
            limpiarHabitacionesSeleccionadas();
        }
        return true;

  }
  // -----------------------------------------------------------
  // 1) Normalizar / validar selecciÃ³n proveniente de la UI
  //    listaSeleccion: [{ habitacion: "IND-101", fechaDesde, fechaHasta }, ...]
  // -----------------------------------------------------------
  extraerDatosSeleccion(listaSeleccion) {
    if (!Array.isArray(listaSeleccion) || listaSeleccion.length === 0) {
      throw new Error("No se recibieron habitaciones seleccionadas.");
    }

    return listaSeleccion.map(item => {
      const { habitacion, fechaDesde, fechaHasta } = item || {};

      if (!habitacion || !fechaDesde || !fechaHasta) {
        throw new Error("La selecciÃ³n de habitaciones es invÃ¡lida.");
      }

      const numero = this.extraerNumero(habitacion);
      if (numero === null) {
        throw new Error(`No se pudo obtener el nÃºmero de habitaciÃ³n desde "${habitacion}".`);
      }

      return {
        habitacion,    // "IND-101"
        numero,        // 101
        fechaDesde,    // "YYYY-MM-DD"
        fechaHasta     // "YYYY-MM-DD"
      };
    });
  }

  // -----------------------------------------------------------
  // 2) Crear modelo de dominio interno
  //    (podrÃ­as mapear esto 1:1 con tus clases Reserva/Habitacion/Titular)
  // -----------------------------------------------------------
  crearReservaDominio(seleccionNormalizada, datosTitular) {
    if (!datosTitular || !datosTitular.nombre || !datosTitular.apellido || !datosTitular.telefono) {
      throw new Error("Los datos del titular estÃ¡n incompletos.");
    }

    const titular = this.crearTitularDominio(datosTitular);

    // Dominio: una reserva por cada habitaciÃ³n seleccionada
    return seleccionNormalizada.map(sel => ({
      fechaInicio: sel.fechaDesde,
      fechaFin: sel.fechaHasta,
      titular: titular,
      estado: "PENDIENTE",
      habitaciones: [
        {
          numero: sel.numero
          // si mÃ¡s adelante querÃ©s: tipo, categoria, etc.
        }
      ]
    }));
  }

  // Titular en el modelo de dominio
  crearTitularDominio(t) {
    return {
      nombre: t.nombre,
      apellido: t.apellido,
      telefono: t.telefono
      // acÃ¡ tranquilamente podrÃ­as agregar mÃ¡s campos (DNI, etc.) si despuÃ©s
      // se completan en la UI
    };
  }

  // -----------------------------------------------------------
  // 3) Crear DTO para el backend
  //    Ahora recibe el dominio, no la selecciÃ³n cruda
  // -----------------------------------------------------------
  crearReservaDTO(reservasDominio) {
    if (!Array.isArray(reservasDominio) || reservasDominio.length === 0) {
      throw new Error("No hay reservas en el modelo de dominio.");
    }

    return reservasDominio.map(r => ({
      fechaInicio: r.fechaInicio,
      fechaFin: r.fechaFin,
      titular: this.crearTitularDTO(r.titular),
      habitaciones: r.habitaciones.map(h => ({
        numero: h.numero
      }))
    }));
  }

  // DTO del titular para backend
  crearTitularDTO(t) {
    if (!t) return null;
    return {
      nombre: t.nombre,
      apellido: t.apellido,
      telefono: t.telefono
    };
  }

  // -----------------------------------------------------------
  // 4) Guardar en la BD (backend REST)
  //    Hace el POST de CADA reserva DTO
  // -----------------------------------------------------------
  async guardarEnBD(reservasDTO) {
    if (!Array.isArray(reservasDTO) || reservasDTO.length === 0) {
      throw new Error("No hay reservas para guardar.");
    }

    console.log("ğŸ’¾ Enviando reservas al backendâ€¦", reservasDTO);

    for (const reserva of reservasDTO) {
      const respuesta = await fetch("http://localhost:8080/api/reservas", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(reserva)
      });

      if (!respuesta.ok) {
        // PodrÃ­as inspeccionar respuesta.status / respuesta.text()
        throw new Error("No se pudo crear la reserva en el backend.");
      }
    }

    // Si llegamos hasta acÃ¡, se crearon todas correctamente
    if (typeof mensajeCorrecto === "function") {
      mensajeCorrecto("Reservas creadas correctamente.");
    }

    // Limpiar selecciÃ³n y ocultar panel de resultados
    if (typeof limpiarHabitacionesSeleccionadas === "function") {
      limpiarHabitacionesSeleccionadas();
    }

    const cont = document.querySelector(".contenedor-resultados");
    if (cont) {
      cont.style.display = "none";
    }
  }

  // -----------------------------------------------------------
  // Utilidad: obtener nÃºmero desde "TIPO-410"
  // -----------------------------------------------------------
  extraerNumero(nombreHabitacion) {
    // Si ya tenÃ©s la funciÃ³n global, podrÃ­as reutilizarla:
    if (typeof obtenerNumeroDesdeNombre === "function") {
      return obtenerNumeroDesdeNombre(nombreHabitacion);
    }

    const partes = (nombreHabitacion || "").split("-");
    const num = parseInt(partes[1]);
    return isNaN(num) ? null : num;
  }
}

// ---------------------------------------------------------------
// Exponer en window para poder jugar en consola si querÃ©s
// ---------------------------------------------------------------
window.GestorRealizarReserva = GestorRealizarReserva;



// [JS/HabitacionDAO.js]
// JS/HabitacionDAO.js
// =======================================================
// HabitacionDAO
//  - listarHabitaciones(): usa datos-habitaciones.js
// =======================================================

class HabitacionDAO {

  static async listarHabitaciones() {
    try {
        console.log("Solicitando habitaciones al backendâ€¦");

        const res = await fetch("http://localhost:8080/api/habitaciones");
        if (!res.ok) throw new Error("Error al cargar habitaciones.");

        HABITACIONES = await res.json();
        datosHabitacionesCargados = true;

        console.log("Habitaciones obtenidas:", HABITACIONES);
        console.log("Total habitaciones:", HABITACIONES.length);
        return HABITACIONES;
    } catch (err) {
        console.error(err);
        mensajeError("No se pudieron cargar las habitaciones.");
        HABITACIONES = [];
        return HABITACIONES;
    }

    throw new Error("No se pudieron obtener las habitaciones.");
  }
}

export { HabitacionDAO };
window.HabitacionDAO = HabitacionDAO;



// [JS/leyenda.js]
// [JS/leyenda.js]
function mostrarLeyenda() {
  const resultado = document.querySelector('.contenedor-resultados');
  if (!resultado) return;

  // Ocultar contenido real
  resultado.style.display = "none";

  // Overlay por encima de todo
  const overlay = document.createElement("div");
  overlay.className = "overlay-leyenda";
  overlay.style.cssText = `
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  `;

  // Caja principal
  const box = document.createElement("div");
  box.className = "leyenda-box";
  box.style.cssText = `
    position: relative;
    background: white;
    padding: 30px;
    border-radius: 15px;
    width: 90%;
    max-width: 600px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
    color: #412c26;
  `;

  box.innerHTML = `
    <span class="icono-cerrar-leyenda">&times;</span>

    <fieldset class="leyenda-section">
      <h3>Estados de habitaciones:</h3>

      <div class="item-leyenda"><div class="caja-color color-libre"></div> Libre</div>
      <div class="item-leyenda"><div class="caja-color color-ocupada"></div> Ocupada</div>
      <div class="item-leyenda"><div class="caja-color color-reservada"></div> Reservada</div>
      <div class="item-leyenda"><div class="caja-color color-seleccionada"></div> Seleccionada</div>
      <div class="item-leyenda"><div class="caja-color color-fuera-servicio"></div> Fuera de Servicio</div>
    </fieldset>

    <fieldset class="leyenda-section" style="margin-top:20px;">
      <h3>Tipos de HabitaciÃ³n</h3>
      <p>IND â†’ Individual</p>
      <p>DOBE â†’ Doble EstÃ¡ndar</p>
      <p>DOBS â†’ Doble Superior</p>
      <p>DOBL â†’ Doble (sin categorÃ­a)</p>
      <p>FAM â†’ Family Plan</p>
      <p>SUITE â†’ Suite Doble</p>
    </fieldset>
  `;

  overlay.appendChild(box);
  document.body.appendChild(overlay);

  // Evento cerrar
  const btnCerrar = box.querySelector(".icono-cerrar-leyenda");
  btnCerrar.style.cssText = `
    position:absolute;
    top:10px;
    right:15px;
    font-size:32px;
    color:#64443a;
    cursor:pointer;
  `;

  btnCerrar.onclick = () => {
    overlay.remove();
    resultado.style.display = "block";
  };
}

function inicializarLeyenda() {
  const icono = document.querySelector('.icono-informacion');
  if (icono) icono.onclick = mostrarLeyenda;
}

if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", inicializarLeyenda);
} else {
  inicializarLeyenda();
}






// [JS/modales.js]
// [JS/modales.js]



function mensajeError(mensaje) {
  const modal = document.getElementById('modal-error');
  const mensajeError = document.getElementById('mensaje-error');
  
  if (!modal || !mensajeError) {
    console.error('Modal de error no encontrado');
    return;
  }
  
  mensajeError.textContent = mensaje;
  modal.style.display = "flex";
  
  window.onclick = function(event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }

  const botonOk = document.getElementById('boton-ok');
  if (botonOk) {
    botonOk.onclick = function() {
      modal.style.display = "none";
    };
  }
}


function mensajeCorrecto(mensaje) {
  if (mensaje == undefined) mensaje = "AcciÃ³n ejecutada con Ã©xito";
  
  const modal = document.getElementById('modal-correcto');
  const mensajeCorrectoElement = document.getElementById('mensaje-correcto');
  
  if (!modal) {
    console.error('Modal de correcto no encontrado');
    return;
  }
  
  if (!mensajeCorrectoElement) {
    console.error('Elemento mensaje-correcto no encontrado');
    return;
  }
  
  mensajeCorrectoElement.innerHTML = mensaje;
  modal.style.display = "flex";
  
  
  modal.style.zIndex = "9999";
  
  window.onkeydown = function() {
    modal.style.display = "none";
  };
}


function mensajeAdvertencia(mensaje) {
  const modal = document.getElementById('modal-advertencia');
  const mensajeAdvertencia = document.getElementById('mensaje-advertencia');
  
  if (!modal || !mensajeAdvertencia) {
    console.error('Modal de advertencia no encontrado');
    return;
  }
  
  mensajeAdvertencia.textContent = mensaje;
  modal.style.display = "flex";
}




// [JS/mostrar-json-reserva.js]



function convertirReservaDTOAJSONConFechasIndividuales(habitacionesConFechas, reservaDTO) {
    
    const titular = reservaDTO.titular ? {
        nombre: reservaDTO.titular.nombre || '',
        apellido: reservaDTO.titular.apellido || '',
        telefono: reservaDTO.titular.telefono || ''
    } : null;

    
    const reservasJSON = habitacionesConFechas.map((item, index) => {
        
        const habitacionIndividual = {
            numero: item.habitacion.numero,
            tipo: item.habitacion.tipo,
            categoria: item.habitacion.categoria || '',
            costoPorNoche: item.habitacion.costoNoche || item.habitacion.costoPorNoche || 0,
            estadoHabitacion: item.habitacion.estado || item.habitacion.estadoHabitacion || 'Disponible'
        };

        
        
        const reservaJSON = {
            id: null, 
            fechaInicio: item.fechaDesde,
            fechaFin: item.fechaHasta,
            titular: titular,
            estado: reservaDTO.estado || 'Pendiente',
            habitaciones: [habitacionIndividual] 
        };
        
        return reservaJSON;
    });
    
    return reservasJSON;
}


function convertirReservaDTOAJSON(reservaDTO) {
    const reservasFormatoJSON = [];
    
    
    const titularCompleto = reservaDTO.titular ? {
        nombre: reservaDTO.titular.nombre || '',
        apellido: reservaDTO.titular.apellido || '',
        telefono: reservaDTO.titular.telefono || '',
        tipoDocumento: reservaDTO.titular.tipoDocumento || null,
        nroDocumento: reservaDTO.titular.nroDocumento || null,
        fechaNacimiento: reservaDTO.titular.fechaNacimiento || null,
        ocupacion: reservaDTO.titular.ocupacion || null,
        nacionalidad: reservaDTO.titular.nacionalidad || null,
        cuit: reservaDTO.titular.cuit || null,
        email: reservaDTO.titular.email || null
    } : null;

    
    const habitacionesCompletas = reservaDTO.habitaciones ? reservaDTO.habitaciones.map(hab => ({
        numero: hab.numero,
        tipo: hab.tipo,
        categoria: hab.categoria || '',
        costoPorNoche: hab.costoPorNoche || hab.costoNoche,
        estadoHabitacion: hab.estadoHabitacion || null
    })) : [];
    
    if (reservaDTO.habitaciones && reservaDTO.habitaciones.length > 0) {
        
        reservaDTO.habitaciones.forEach(habitacion => {
        reservasFormatoJSON.push({
            id: reservaDTO.id || null,
            fechaInicio: reservaDTO.fechaInicio,
            fechaFin: reservaDTO.fechaFin,
            titular: titularCompleto,
            estado: reservaDTO.estado || null,
            habitaciones: habitacionesCompletas
        });
        });
    } else {
        
        reservasFormatoJSON.push({
            id: reservaDTO.id || null,
            fechaInicio: reservaDTO.fechaInicio,
            fechaFin: reservaDTO.fechaFin,
            titular: titularCompleto,
            estado: reservaDTO.estado || null,
            habitaciones: habitacionesCompletas,
            
            numeroHabitacion: null,
            desde: reservaDTO.fechaInicio,
            hasta: reservaDTO.fechaFin,
            responsable: reservaDTO.titular 
                ? `${reservaDTO.titular.apellido || ''}, ${reservaDTO.titular.nombre || ''}`.trim()
                : '',
            telefono: reservaDTO.titular ? reservaDTO.titular.telefono || '' : ''
        });
    }
    
    return reservasFormatoJSON;
}


async function guardarReservaConFechasIndividuales(nuevasReservas) {
    try {
        
        const respuesta = await fetch('/Datos/reservas.json');
        let reservasExistentes = [];
        
        if (respuesta.ok) {
            const datos = await respuesta.json();
            reservasExistentes = datos.reservas || [];
        }

        
        reservasExistentes.push(...nuevasReservas);

        
        console.log('=== FORMATO FINAL PARA JSON ===');
        console.log('Reservas a agregar al JSON (una por cada habitaciÃ³n):', nuevasReservas);
        console.log('Total de reservas a agregar:', nuevasReservas.length);
        console.log('==============================');
        
        
        
    } catch (error) {
        console.error('Error al guardar reserva en BD:', error);
        throw error;
    }
}


function mostrarJSONReservaEnPantalla(nuevasReservas, reservaDTO, callbackCerrar) {
    
    let contenedorJSON = document.getElementById('contenedor-json-reserva');
    
    if (!contenedorJSON) {
        
        contenedorJSON = document.createElement('div');
        contenedorJSON.id = 'contenedor-json-reserva';
        contenedorJSON.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border: 2px solid #333;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            z-index: 10001;
            font-family: Arial, sans-serif;
        `;

        
        const titulo = document.createElement('h2');
        titulo.textContent = 'Datos a enviar al servidor backend';
        titulo.style.cssText = 'margin-top: 0; margin-bottom: 15px; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px;';
        contenedorJSON.appendChild(titulo);

        
        const infoAdicional = document.createElement('div');
        infoAdicional.style.cssText = 'display: none; margin-bottom: 15px; padding: 10px; background: #e7f3ff; border-radius: 4px; font-size: 14px;';
        infoAdicional.id = 'info-adicional-reserva';
        contenedorJSON.appendChild(infoAdicional);

        
        const textarea = document.createElement('textarea');
        textarea.id = 'json-display-reserva';
        textarea.readOnly = true;
        textarea.style.cssText = `
            width: 100%;
            min-height: 400px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
            box-sizing: border-box;
            background: #f8f9fa;
            line-height: 1.5;
        `;
        contenedorJSON.appendChild(textarea);

        
        const botonCerrar = document.createElement('button');
        botonCerrar.textContent = 'Cerrar';
        botonCerrar.style.cssText = `
            margin-top: 15px;
            padding: 10px 30px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background 0.3s;
        `;
        botonCerrar.onclick = function() {
            contenedorJSON.style.display = 'none';
            
            if (typeof callbackCerrar === 'function') {
                callbackCerrar();
            }
        };
        botonCerrar.onmouseover = function() {
            this.style.background = '#0056b3';
        };
        botonCerrar.onmouseout = function() {
            this.style.background = '#007bff';
        };
        contenedorJSON.appendChild(botonCerrar);
        
        
        contenedorJSON._callbackCerrar = callbackCerrar;

        
        document.body.appendChild(contenedorJSON);
    }

    
    const jsonFormateado = JSON.stringify(nuevasReservas, null, 2);
    
    
    
    
    const textarea = document.getElementById('json-display-reserva');
    if (textarea) {
        
        textarea.value = jsonFormateado;
        
        textarea.scrollTop = 0;
    }

    
    if (typeof callbackCerrar === 'function') {
        contenedorJSON._callbackCerrar = callbackCerrar;
        
        const botonCerrar = contenedorJSON.querySelector('button');
        if (botonCerrar) {
            botonCerrar.onclick = function() {
                contenedorJSON.style.display = 'none';
                if (typeof callbackCerrar === 'function') {
                    callbackCerrar();
                }
            };
        }
    }

    
    contenedorJSON.style.display = 'block';

    
    console.log('=== DATOS A ENVIAR A LA BASE DE DATOS ===');
    console.log('ReservaDTO completo:', reservaDTO);
    console.log('Reservas a agregar a la BD (una por cada habitaciÃ³n):', nuevasReservas);
    console.log('JSON formateado:', jsonFormateado);
    console.log('Total de reservas a agregar:', nuevasReservas.length);
    console.log('==========================================');
}


window.convertirReservaDTOAJSONConFechasIndividuales = convertirReservaDTOAJSONConFechasIndividuales;
window.mostrarJSONReservaEnPantalla = mostrarJSONReservaEnPantalla;



// [JS/mostrar-json-reserva.js]
// [JS/mostrar-json-reserva.js]



function convertirReservaDTOAJSONConFechasIndividuales(habitacionesConFechas, reservaDTO) {
    
    const titular = reservaDTO.titular ? {
        nombre: reservaDTO.titular.nombre || '',
        apellido: reservaDTO.titular.apellido || '',
        telefono: reservaDTO.titular.telefono || ''
    } : null;

    
    const reservasJSON = habitacionesConFechas.map((item, index) => {
        
        const habitacionIndividual = {
            numero: item.habitacion.numero,
            tipo: item.habitacion.tipo,
            categoria: item.habitacion.categoria || '',
            costoPorNoche: item.habitacion.costoNoche || item.habitacion.costoPorNoche || 0,
            estadoHabitacion: item.habitacion.estado || item.habitacion.estadoHabitacion || 'Disponible'
        };

        
        
        const reservaJSON = {
            id: null, 
            fechaInicio: item.fechaDesde,
            fechaFin: item.fechaHasta,
            titular: titular,
            estado: reservaDTO.estado || 'Pendiente',
            habitaciones: [habitacionIndividual] 
        };
        
        return reservaJSON;
    });
    
    return reservasJSON;
}


function convertirReservaDTOAJSON(reservaDTO) {
    const reservasFormatoJSON = [];
    
    
    const titularCompleto = reservaDTO.titular ? {
        nombre: reservaDTO.titular.nombre || '',
        apellido: reservaDTO.titular.apellido || '',
        telefono: reservaDTO.titular.telefono || '',
        tipoDocumento: reservaDTO.titular.tipoDocumento || null,
        nroDocumento: reservaDTO.titular.nroDocumento || null,
        fechaNacimiento: reservaDTO.titular.fechaNacimiento || null,
        ocupacion: reservaDTO.titular.ocupacion || null,
        nacionalidad: reservaDTO.titular.nacionalidad || null,
        cuit: reservaDTO.titular.cuit || null,
        email: reservaDTO.titular.email || null
    } : null;

    
    const habitacionesCompletas = reservaDTO.habitaciones ? reservaDTO.habitaciones.map(hab => ({
        numero: hab.numero,
        tipo: hab.tipo,
        categoria: hab.categoria || '',
        costoPorNoche: hab.costoPorNoche || hab.costoNoche,
        estadoHabitacion: hab.estadoHabitacion || null
    })) : [];
    
    if (reservaDTO.habitaciones && reservaDTO.habitaciones.length > 0) {
        
        reservaDTO.habitaciones.forEach(habitacion => {
        reservasFormatoJSON.push({
            id: reservaDTO.id || null,
            fechaInicio: reservaDTO.fechaInicio,
            fechaFin: reservaDTO.fechaFin,
            titular: titularCompleto,
            estado: reservaDTO.estado || null,
            habitaciones: habitacionesCompletas
        });
        });
    } else {
        
        reservasFormatoJSON.push({
            id: reservaDTO.id || null,
            fechaInicio: reservaDTO.fechaInicio,
            fechaFin: reservaDTO.fechaFin,
            titular: titularCompleto,
            estado: reservaDTO.estado || null,
            habitaciones: habitacionesCompletas,
            
            numeroHabitacion: null,
            desde: reservaDTO.fechaInicio,
            hasta: reservaDTO.fechaFin,
            responsable: reservaDTO.titular 
                ? `${reservaDTO.titular.apellido || ''}, ${reservaDTO.titular.nombre || ''}`.trim()
                : '',
            telefono: reservaDTO.titular ? reservaDTO.titular.telefono || '' : ''
        });
    }
    
    return reservasFormatoJSON;
}


async function guardarReservaConFechasIndividuales(nuevasReservas) {
    try {
        
        const respuesta = await fetch('/Datos/reservas.json');
        let reservasExistentes = [];
        
        if (respuesta.ok) {
            const datos = await respuesta.json();
            reservasExistentes = datos.reservas || [];
        }

        
        reservasExistentes.push(...nuevasReservas);

        
        console.log('=== FORMATO FINAL PARA JSON ===');
        console.log('Reservas a agregar al JSON (una por cada habitaciÃ³n):', nuevasReservas);
        console.log('Total de reservas a agregar:', nuevasReservas.length);
        console.log('==============================');
        
        
        
    } catch (error) {
        console.error('Error al guardar reserva en BD:', error);
        throw error;
    }
}


function mostrarJSONReservaEnPantalla(nuevasReservas, reservaDTO, callbackCerrar) {
    
    let contenedorJSON = document.getElementById('contenedor-json-reserva');
    
    if (!contenedorJSON) {
        
        contenedorJSON = document.createElement('div');
        contenedorJSON.id = 'contenedor-json-reserva';
        contenedorJSON.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border: 2px solid #333;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            z-index: 10001;
            font-family: Arial, sans-serif;
        `;

        
        const titulo = document.createElement('h2');
        titulo.textContent = 'Datos a enviar al servidor backend';
        titulo.style.cssText = 'margin-top: 0; margin-bottom: 15px; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px;';
        contenedorJSON.appendChild(titulo);

        
        const infoAdicional = document.createElement('div');
        infoAdicional.style.cssText = 'display: none; margin-bottom: 15px; padding: 10px; background: #e7f3ff; border-radius: 4px; font-size: 14px;';
        infoAdicional.id = 'info-adicional-reserva';
        contenedorJSON.appendChild(infoAdicional);

        
        const textarea = document.createElement('textarea');
        textarea.id = 'json-display-reserva';
        textarea.readOnly = true;
        textarea.style.cssText = `
            width: 100%;
            min-height: 400px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
            box-sizing: border-box;
            background: #f8f9fa;
            line-height: 1.5;
        `;
        contenedorJSON.appendChild(textarea);

        
        const botonCerrar = document.createElement('button');
        botonCerrar.textContent = 'Cerrar';
        botonCerrar.style.cssText = `
            margin-top: 15px;
            padding: 10px 30px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: background 0.3s;
        `;
        botonCerrar.onclick = function() {
            contenedorJSON.style.display = 'none';
            
            if (typeof callbackCerrar === 'function') {
                callbackCerrar();
            }
        };
        botonCerrar.onmouseover = function() {
            this.style.background = '#0056b3';
        };
        botonCerrar.onmouseout = function() {
            this.style.background = '#007bff';
        };
        contenedorJSON.appendChild(botonCerrar);
        
        
        contenedorJSON._callbackCerrar = callbackCerrar;

        
        document.body.appendChild(contenedorJSON);
    }

    
    const jsonFormateado = JSON.stringify(nuevasReservas, null, 2);
    
    
    
    
    const textarea = document.getElementById('json-display-reserva');
    if (textarea) {
        
        textarea.value = jsonFormateado;
        
        textarea.scrollTop = 0;
    }

    
    if (typeof callbackCerrar === 'function') {
        contenedorJSON._callbackCerrar = callbackCerrar;
        
        const botonCerrar = contenedorJSON.querySelector('button');
        if (botonCerrar) {
            botonCerrar.onclick = function() {
                contenedorJSON.style.display = 'none';
                if (typeof callbackCerrar === 'function') {
                    callbackCerrar();
                }
            };
        }
    }

    
    contenedorJSON.style.display = 'block';

    
    console.log('=== DATOS A ENVIAR A LA BASE DE DATOS ===');
    console.log('ReservaDTO completo:', reservaDTO);
    console.log('Reservas a agregar a la BD (una por cada habitaciÃ³n):', nuevasReservas);
    console.log('JSON formateado:', jsonFormateado);
    console.log('Total de reservas a agregar:', nuevasReservas.length);
    console.log('==========================================');
}


window.convertirReservaDTOAJSONConFechasIndividuales = convertirReservaDTOAJSONConFechasIndividuales;
window.mostrarJSONReservaEnPantalla = mostrarJSONReservaEnPantalla;







// [JS/reserva.js]
// [JS/reserva.js]
// ==============================================================
//  reserva.js â€” VERSIÃ“N REORGANIZADA
//  âœ” Maneja solo la interacciÃ³n con la UI
//  âœ” Llama a GestorReserva.realizarReserva(listaSeleccion, datosTitular)
//  âœ” El fetch y el armado de DTO/dominio estÃ¡ en los Gestores
// ==============================================================

import GestorReserva from "../GestorReserva.js";

// ------------------------------------------------------------
// 1) MANEJAR BÃšSQUEDA â†’ cargar tabla
// ------------------------------------------------------------
function manejarBusqueda() {
  const form = document.querySelector("form");
  if (!form) return;

  form.addEventListener("submit", async e => {
    e.preventDefault();
    GestorReserva.buscarReservaEntreDosFechas();
  });
}

// ------------------------------------------------------------
// 2) CLICK EN "RESERVAR" â†’ abrir confirmaciÃ³n
// ------------------------------------------------------------
function manejarClickReservar() {
  const btn = document.querySelector(".boton-reservar");
  if (!btn) return;

  btn.addEventListener("click", () => {
    const seleccion = obtenerHabitacionesSeleccionadas();
    if (!seleccion.length) {
      mensajeError("Debe seleccionar al menos una habitaciÃ³n.");
      return;
    }
    mostrarConfirmacion(seleccion);
  });
}

// ------------------------------------------------------------
// 3) PANEL DE CONFIRMACIÃ“N
// ------------------------------------------------------------
function mostrarConfirmacion(lista) {
  const base = document.querySelector(".contenedor-resultados");
  if (base) base.style.display = "none";

  const overlay = document.createElement("div");
  overlay.className = "overlay-confirmacion";
  overlay.style.cssText = `
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.45);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9998;
  `;

  const panel = document.createElement("div");
  panel.className = "panel-confirmacion";
  panel.style.cssText = `
    background: white;
    width: 90%;
    max-width: 600px;
    border: 2px solid #412c26;
    border-radius: 10px;
    padding: 25px;
  `;

  panel.innerHTML = `<h2>ConfirmÃ¡ la selecciÃ³n</h2>`;

  lista.forEach(sel => {
    panel.innerHTML += `
      <p style="margin:8px 0;">
        <strong>${sel.habitacion}</strong> â€”
        Desde <strong>${sel.fechaDesde}</strong>
        hasta <strong>${sel.fechaHasta}</strong>
      </p>
    `;
  });

  const contBot = document.createElement("div");
  contBot.style.cssText = `
    margin-top:20px;
    display:flex;
    justify-content:flex-end;
    gap:12px;
  `;

  const btnCancelar = document.createElement("button");
  btnCancelar.className = "boton-reserva-estandar";
  btnCancelar.textContent = "Cancelar";
  btnCancelar.onclick = () => {
    overlay.remove();
    if (base) base.style.display = "block";
    if (typeof limpiarHabitacionesSeleccionadas === "function") {
      limpiarHabitacionesSeleccionadas();
    }
  };

  const btnOk = document.createElement("button");
  btnOk.className = "boton-reserva-estandar";
  btnOk.textContent = "Continuar";
  btnOk.onclick = () => {
    overlay.remove();
    mostrarFormularioTitular(lista);
  };

  contBot.appendChild(btnCancelar);
  contBot.appendChild(btnOk);

  panel.appendChild(contBot);
  overlay.appendChild(panel);
  document.body.appendChild(overlay);
}

// ------------------------------------------------------------
// 4) FORMULARIO DE TITULAR
// ------------------------------------------------------------
function mostrarFormularioTitular(listaSeleccion) {
  const overlay = document.createElement("div");
  overlay.style.cssText = `
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.45);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:9999;
  `;

  const box = document.createElement("div");
  box.className = "formulario-datos-huesped";
  box.style.cssText = `
    width:90%;
    max-width:600px;
    background:white;
    padding:40px;
    border-radius:15px;
    box-shadow:0 8px 30px rgba(0,0,0,0.2);
  `;

  box.innerHTML = `
    <h2 class="titulo-formulario-huesped">Datos del Titular</h2>

    <div class="cuadricula-formulario-huesped">
      <div class="contenedor-campo-huesped">
        <label>Nombre</label>
        <input id="tit-nombre" class="campo-huesped" placeholder="IngresÃ¡ nombre">
      </div>

      <div class="contenedor-campo-huesped">
        <label>Apellido</label>
        <input id="tit-apellido" class="campo-huesped" placeholder="IngresÃ¡ apellido">
      </div>

      <div class="contenedor-campo-huesped">
        <label>TelÃ©fono</label>
        <input id="tit-telefono" class="campo-huesped" placeholder="Ej: 341-5555555">
      </div>
    </div>

    <div style="display:flex; justify-content:flex-end; gap:15px; margin-top:20px;">
        <button id="btn-tit-cancelar" class="boton-reserva-estandar">Cancelar</button>
        <button id="btn-tit-confirmar" class="boton-reserva-estandar">Confirmar Reserva</button>
    </div>
  `;

  overlay.appendChild(box);
  document.body.appendChild(overlay);

  document.getElementById("btn-tit-cancelar").onclick = () => {
    overlay.remove();
    const base = document.querySelector(".contenedor-resultados");
    if (base) base.style.display = "block";
  };

  document.getElementById("btn-tit-confirmar").onclick = async () => {
    const nombre = document.getElementById("tit-nombre").value.trim();
    const apellido = document.getElementById("tit-apellido").value.trim();
    const telefono = document.getElementById("tit-telefono").value.trim();

    if (!nombre || !apellido || !telefono) {
      mensajeError("Complete todos los campos.");
      return;
    }

    // AcÃ¡ delegamos TODO al director GestorReserva
    await GestorReserva.realizarReserva(listaSeleccion, { nombre, apellido, telefono });

    // Cierro el formulario (el resto de la UI se maneja desde los gestores)
    overlay.remove();
  };
}

// ------------------------------------------------------------
// InicializaciÃ³n
// ------------------------------------------------------------
function inicializarReserva() {
  console.log("Estoy aca");
  manejarBusqueda();
  manejarClickReservar();
}

if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", inicializarReserva);
} else {
  inicializarReserva();
}



// [JS/ReservaDAO.js]
// JS/ReservaDAO.js
// =======================================================
// ReservaDAO
//  - buscarReservasEntre(desde,hasta)
//  - guardarReserva(reserva)
//  Usa datos-habitaciones.js para el GET de reservas
// =======================================================

class ReservaDAO {

  static async buscarReservasEntre(desde, hasta) {
    try {
        const url = `http://localhost:8080/api/reservas/entre?inicio=${desde}&fin=${hasta}`;
        console.log("Solicitando reservas:", url);

        const res = await fetch(url);
        if (!res.ok) throw new Error("Error al cargar reservas.");

        RESERVAS = await res.json();
        console.log("Reservas recibidas:", RESERVAS);
        
        return RESERVAS;
    } catch (err) {
        console.error(err);
        mensajeError("Error cargando reservas desde el backend.");
        RESERVAS = [];
    }
    throw new Error("No se pudieron obtener las reservas.");
  }

  static async guardarReserva(reserva) {
    const respuesta = await fetch("http://localhost:8080/api/reservas", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(reserva)
    });

    if (!respuesta.ok) {
      throw new Error("No se pudo guardar la reserva en el backend.");
    }
  }
}

export { ReservaDAO };
window.ReservaDAO = ReservaDAO;



// [JS/seleccion-habitaciones.js]


// [JS/seleccion-habitaciones.js]
// ===========================================================
//   seleccion-habitaciones.js â€” VERSIÃ“N FINAL
//   âœ” SelecciÃ³n por rangos sin desplazar fechas
//   âœ” Compatible con cÃ³digos IND/DOBE/DOBS/FAM/SUITE
//   âœ” Sin alias (usa texto EXACTO de generar-tabla: "TIPO-101")
// ===========================================================

let HAB_SELECCIONADAS = [];
let inicioSeleccion = null;

// ===========================================================
//   Obtener lista actual
// ===========================================================
function obtenerHabitacionesSeleccionadas() {
  return HAB_SELECCIONADAS;
}

function limpiarHabitacionesSeleccionadas() {
  HAB_SELECCIONADAS = [];
  inicioSeleccion = null;

  document.querySelectorAll(".tabla-habitaciones td").forEach(celda => {
    if (!celda.dataset.estadoOriginal) return;

    celda.classList.remove("estado-seleccionada");
    celda.style.backgroundColor = "";

    celda.classList.add(
      celda.dataset.estadoOriginal === "reservada"
        ? "estado-reservada"
        : "estado-libre"
    );
  });

  aplicarEstilosCeldas();
}

// ===========================================================
//   Seleccionar rango
// ===========================================================
function seleccionarRango(nombreHabitacion, fechaDesde, fechaHasta) {
  if (compararFechas(fechaDesde, fechaHasta) > 0)
    [fechaDesde, fechaHasta] = [fechaHasta, fechaDesde];

  const numero = obtenerNumeroDesdeNombre(nombreHabitacion);
  const fechasRango = generarArrayFechas(fechaDesde, fechaHasta);

  // validar disponibilidad
  const todosLibres = fechasRango.every(fecha =>
    !estaHabitacionReservada(numero, fecha)
  );
  if (!todosLibres) {
    mensajeError("La habitaciÃ³n tiene dÃ­as reservados en ese rango.");
    return;
  }

  // si ya existe â†’ borrar antes
  deseleccionarRango(nombreHabitacion);

  HAB_SELECCIONADAS.push({ habitacion: nombreHabitacion, fechaDesde, fechaHasta });

  fechasRango.forEach(f => {
    const celda = document.querySelector(
      `.tabla-habitaciones td[data-numero-habitacion="${numero}"][data-fecha="${f}"]`
    );

    if (!celda) return;

    if (celda.dataset.estadoOriginal === "libre") {
      celda.classList.add("estado-seleccionada");
      celda.style.backgroundColor = "yellow";
    }
  });
}

function deseleccionarRango(nombreHabitacion) {
  const idx = HAB_SELECCIONADAS.findIndex(s => s.habitacion === nombreHabitacion);
  if (idx === -1) return;

  const seleccion = HAB_SELECCIONADAS[idx];
  HAB_SELECCIONADAS.splice(idx, 1);

  const numero = obtenerNumeroDesdeNombre(nombreHabitacion);
  const fechas = generarArrayFechas(seleccion.fechaDesde, seleccion.fechaHasta);

  fechas.forEach(f => {
    const celda = document.querySelector(
      `.tabla-habitaciones td[data-numero-habitacion="${numero}"][data-fecha="${f}"]`
    );
    if (!celda) return;

    celda.classList.remove("estado-seleccionada");
    celda.style.backgroundColor = "";

    celda.classList.add(
      celda.dataset.estadoOriginal === "reservada"
        ? "estado-reservada"
        : "estado-libre"
    );
  });

  aplicarEstilosCeldas();
}

// ===========================================================
//   Click en celda
// ===========================================================
function manejarClickCelda(celda) {
  if (celda.dataset.estadoOriginal === "reservada") return;

  const numero = celda.dataset.numeroHabitacion;
  const fecha = celda.dataset.fecha;

  // Obtener nombre TIPO-101 desde el header
  let nombreHab = null;
  const headers = document.querySelectorAll(".tabla-habitaciones thead th");

  for (let i = 1; i < headers.length; i++) {
    const texto = headers[i].textContent.trim(); // "IND-101"
    const partes = texto.split("-");
    if (partes.length === 2 && partes[1] === numero) {
      nombreHab = texto;
      break;
    }
  }

  if (!nombreHab) return;

  const seleccionado = HAB_SELECCIONADAS.find(s => s.habitacion === nombreHab);

  // si ya estaba seleccionado y clic dentro â†’ deselecciona
  if (seleccionado) {
    if (
      compararFechas(fecha, seleccionado.fechaDesde) >= 0 &&
      compararFechas(fecha, seleccionado.fechaHasta) <= 0
    ) {
      deseleccionarRango(nombreHab);
      inicioSeleccion = null;
      return;
    }
  }

  // si ya hay un inicio en la misma habitaciÃ³n â†’ cerrar rango
  if (inicioSeleccion && inicioSeleccion.habitacion === nombreHab) {
    seleccionarRango(nombreHab, inicioSeleccion.fecha, fecha);
    inicioSeleccion = null;
    return;
  }

  // iniciar selecciÃ³n
  inicioSeleccion = { habitacion: nombreHab, fecha };
}

// ===========================================================
//   InicializaciÃ³n
// ===========================================================
function inicializarSeleccionHabitaciones() {
  limpiarHabitacionesSeleccionadas();

  const celdas = document.querySelectorAll(".tabla-habitaciones tbody td");
  celdas.forEach(c => {
    if (c.cellIndex === 0) return;

    const nuevo = c.cloneNode(true);
    nuevo.dataset.numeroHabitacion = c.dataset.numeroHabitacion;
    nuevo.dataset.fecha = c.dataset.fecha;
    nuevo.dataset.estadoOriginal = c.dataset.estadoOriginal;
    nuevo.className = c.className;

    c.parentNode.replaceChild(nuevo, c);
  });

  document.querySelectorAll(".tabla-habitaciones tbody td").forEach(c => {
    if (c.cellIndex === 0) return;

    if (c.dataset.estadoOriginal == "libre") {
      c.addEventListener("click", () => manejarClickCelda(c));
      c.style.cursor = "pointer";
    }
  });
}

// Exponer
window.obtenerHabitacionesSeleccionadas = obtenerHabitacionesSeleccionadas;
window.limpiarHabitacionesSeleccionadas = limpiarHabitacionesSeleccionadas;
window.inicializarSeleccionHabitaciones = inicializarSeleccionHabitaciones;






// [JS/tabla-habitaciones.js]
// [JS/tabla-habitaciones.js]
// ====================================================
//   tabla-habitaciones.js  (OpciÃ³n B - versiÃ³n nueva)
// ====================================================

// Aplica colores segÃºn la clase asignada a cada celda
function aplicarEstilosCeldas() {
  const celdas = document.querySelectorAll(".tabla-habitaciones td");

  celdas.forEach(celda => {
    celda.style.color = "#000"; // color base seguro

    if (celda.classList.contains("estado-seleccionada")) {
      celda.style.backgroundColor = "yellow";
      return;
    }

    const estado = celda.dataset.estadoOriginal;

    switch (estado) {
      case "libre":
        celda.style.backgroundColor = "#c3e6cb"; // verde suave
        break;

      case "reservada":
        celda.style.backgroundColor = "#ffeeba"; // amarillo suave
        break;

      case "ocupada":
        celda.style.backgroundColor = "#f5c6cb"; // rojo suave
        break;

      case "fuera-servicio":
        celda.style.backgroundColor = "#c6c8ca"; // gris
        break;
    }
  });
}

// ----------------------------------------------------
// Exponer a window
// ----------------------------------------------------
window.aplicarEstilosCeldas = aplicarEstilosCeldas;

// Ejecutar al inicio
if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", aplicarEstilosCeldas);
} else {
  aplicarEstilosCeldas();
}



// [JS/test.js]
// [JS/test.js]
function testFechas() {
  console.log("â–¶ Ejecutando testFechas()...");

  const desde = document.getElementById("fecha-desde");
  const hasta = document.getElementById("fecha-hasta");
  const form = document.querySelector("form");

  if (!desde || !hasta || !form) {
    console.error("âŒ No se encontraron campos de fecha o formulario.");
    return;
  }

  // Setear fechas automÃ¡ticamente
  desde.value = "2025-12-01";
  hasta.value = "2025-12-30";

  console.log("ğŸ“… Fechas seteadas: 01/12/2025 â†’ 30/12/2025");

  // Disparar el submit del formulario automÃ¡ticamente
  form.dispatchEvent(new Event("submit", { bubbles: true }));

  console.log("ğŸ” Ejecutando bÃºsqueda automÃ¡ticamente...");
}

// Ejecutar testFechas() con ALT + P
document.addEventListener("keydown", (e) => {
  // ALT + P
  if (e.altKey && e.key.toLowerCase() === "p") {
    e.preventDefault();
    console.log("â© Atajo ALT + P detectado â†’ ejecutando testFechas()");
    testFechas();
  }
});




// [JS/UIReservas.js]
// JS/UIReservas.js
// =======================================================
// UIReservas
//  - Maneja la interacciÃ³n con la UI
//  - Llama a GestorReserva para la lÃ³gica
// =======================================================

import { GestorReserva } from "../GestorReserva.js";

class UIReservas {

  // ---------------------------------------------------
  // InicializaciÃ³n general
  // ---------------------------------------------------
  static inicializar() {
    UIReservas.inicializarBusqueda();
    UIReservas.inicializarBotonReservar();
  }

  // ---------------------------------------------------
  // Formulario de bÃºsqueda de fechas
  // ---------------------------------------------------
  static inicializarBusqueda() {
    const form = document.querySelector(".formulario-busqueda form") || document.querySelector("form");
    if (!form) return;

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const desde = document.getElementById("fecha-desde").value;
      const hasta = document.getElementById("fecha-hasta").value;

      const valido = GestorReserva.validarRangoFechas(desde, hasta, UIReservas);
      if (!valido) return;
      await GestorReserva.obtenerEstadoHabitaciones(desde, hasta, UIReservas);
    });
  }

  // ---------------------------------------------------
  // BotÃ³n "Reservar"
  // ---------------------------------------------------
  static inicializarBotonReservar() {
    const btn = document.querySelector(".boton-reservar");
    if (!btn) return;

    btn.addEventListener("click", () => {
      const lista = typeof obtenerHabitacionesSeleccionadas === "function"
        ? obtenerHabitacionesSeleccionadas()
        : [];

      if (!lista || !lista.length) {
        UIReservas.mostrarError("Debe seleccionar al menos una habitaciÃ³n.");
        return;
      }

      UIReservas.mostrarConfirmacion(lista);
    });
  }

  // ---------------------------------------------------
  // Mostrar errores (usa modales.js)
  // ---------------------------------------------------
  static mostrarError(mensaje) {
    if (typeof mensajeError === "function") {
      mensajeError(mensaje);
    } else {
      alert(mensaje);
    }
  }

  // ---------------------------------------------------
  // Mostrar grilla con resultados
  // ---------------------------------------------------
  static mostrarGrilla() {
    const cont = document.querySelector(".contenedor-resultados");
    if (cont) cont.style.display = "block";
  }

  // ---------------------------------------------------
  // Panel de confirmaciÃ³n: listado tipo / ingreso / egreso
  // ---------------------------------------------------
  static mostrarConfirmacion(listaSeleccion) {
    const base = document.querySelector(".contenedor-resultados");
    if (base) base.style.display = "none";

    const overlay = document.createElement("div");
    overlay.style.cssText = `
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9998;
    `;

    const panel = document.createElement("div");
    panel.style.cssText = `
      background: white;
      width: 90%;
      max-width: 600px;
      border: 2px solid #412c26;
      border-radius: 10px;
      padding: 25px;
      font-family: sans-serif;
    `;

    panel.innerHTML = `<h2>ConfirmÃ¡ la selecciÃ³n</h2>`;

    listaSeleccion.forEach(sel => {
      panel.innerHTML += `
        <p style="margin:8px 0;">
          <strong>${sel.habitacion}</strong> â€”
          Desde <strong>${sel.fechaDesde}</strong>
          hasta <strong>${sel.fechaHasta}</strong>
        </p>
      `;
    });

    const contBotones = document.createElement("div");
    contBotones.style.cssText = `
      margin-top: 20px;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    `;

    const btnRechazar = document.createElement("button");
    btnRechazar.className = "boton-reserva-estandar";
    btnRechazar.textContent = "Rechazar";
    btnRechazar.onclick = () => {
      overlay.remove();
      if (base) base.style.display = "block";
      if (typeof limpiarHabitacionesSeleccionadas === "function") {
        limpiarHabitacionesSeleccionadas();
      }
    };

    const btnAceptar = document.createElement("button");
    btnAceptar.className = "boton-reserva-estandar";
    btnAceptar.textContent = "Aceptar";
    btnAceptar.onclick = () => {
      overlay.remove();
      UIReservas.mostrarFormularioTitular(listaSeleccion);
    };

    contBotones.appendChild(btnRechazar);
    contBotones.appendChild(btnAceptar);

    panel.appendChild(contBotones);
    overlay.appendChild(panel);
    document.body.appendChild(overlay);
  }

  // ---------------------------------------------------
  // Formulario de titular (Apellido, Nombre, TelÃ©fono)
  // ---------------------------------------------------
  static mostrarFormularioTitular(listaSeleccion) {
    const overlay = document.createElement("div");
    overlay.style.cssText = `
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.45);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    `;

    const box = document.createElement("div");
    box.className = "formulario-datos-huesped";
    box.style.cssText = `
      width: 90%;
      max-width: 600px;
      background: white;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.2);
    `;

    box.innerHTML = `
      <h2 class="titulo-formulario-huesped">Datos del Titular</h2>

      <div class="cuadricula-formulario-huesped">
        <div class="contenedor-campo-huesped">
          <label>Nombre</label>
          <input id="tit-nombre" class="campo-huesped" placeholder="IngresÃ¡ nombre">
        </div>

        <div class="contenedor-campo-huesped">
          <label>Apellido</label>
          <input id="tit-apellido" class="campo-huesped" placeholder="IngresÃ¡ apellido">
        </div>

        <div class="contenedor-campo-huesped">
          <label>TelÃ©fono</label>
          <input id="tit-telefono" class="campo-huesped" placeholder="Ej: 341-5555555">
        </div>
      </div>

      <div style="display:flex; justify-content:flex-end; gap:15px; margin-top:20px;">
        <button id="btn-tit-cancelar" class="boton-reserva-estandar">Cancelar</button>
        <button id="btn-tit-confirmar" class="boton-reserva-estandar">Confirmar Reserva</button>
      </div>
    `;

    overlay.appendChild(box);
    document.body.appendChild(overlay);

    const btnCancelar = document.getElementById("btn-tit-cancelar");
    const btnConfirmar = document.getElementById("btn-tit-confirmar");

    btnCancelar.onclick = () => {
      overlay.remove();
      const base = document.querySelector(".contenedor-resultados");
      if (base) base.style.display = "block";
    };

    btnConfirmar.onclick = async () => {
      const nombre = document.getElementById("tit-nombre").value.trim();
      const apellido = document.getElementById("tit-apellido").value.trim();
      const telefono = document.getElementById("tit-telefono").value.trim();

      if (!nombre || !apellido || !telefono) {
        UIReservas.mostrarError("Complete todos los campos obligatorios del titular.");
        return;
      }

      const desde = document.getElementById("fecha-desde").value;
      const hasta = document.getElementById("fecha-hasta").value;

      await GestorReserva.crearReserva(
        listaSeleccion,
        { nombre, apellido, telefono },
        desde,
        hasta,
        UIReservas
      );

      overlay.remove();
    };
  }

  // ---------------------------------------------------
  // Mensaje final de Ã©xito
  // ---------------------------------------------------
  static mostrarReservaExitosa() {
    if (typeof mensajeCorrecto === "function") {
      mensajeCorrecto("Reserva registrada con Ã©xito.");
    } else {
      alert("Reserva registrada con Ã©xito.");
    }
    // PodÃ©s ajustar esto si no querÃ©s recargar
    location.reload();
  }
}

if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", () => UIReservas.inicializar());
} else {
  UIReservas.inicializar();
}

export { UIReservas };
window.UIReservas = UIReservas;



// [JS/validaciones-campos.js]

// [JS/validaciones-campos.js]



function validarFecha(campoFecha, nombreCampo) {
  if (!campoFecha.value) {
    mensajeError(`Por favor, ingrese una fecha vÃ¡lida en "${nombreCampo}".`);
    campoFecha.focus();
    return false;
  }
  return true;
}


function validarRangoFechas(checkinInput, checkoutInput) {
  if (new Date(checkinInput.value) >= new Date(checkoutInput.value)) {
    mensajeError('La fecha de salida debe ser posterior a la fecha de entrada.');
    checkinInput.value = '';
    checkoutInput.value = '';
    checkinInput.focus();
    return false;
  }
  return true;
}


function validarFormularioBusqueda() {
  const checkinInput = document.getElementById('fecha-desde');
  const checkoutInput = document.getElementById('fecha-hasta');

  if (!validarFecha(checkinInput, 'Desde fecha')) {
    return false;
  }

  if (!validarFecha(checkoutInput, 'Hasta fecha')) {
    return false;
  }

  if (!validarRangoFechas(checkinInput, checkoutInput)) {
    return false;
  }

  return true;
}


function inicializarValidacionesCampos() {
  const checkinInput = document.getElementById('fecha-desde');
  const checkoutInput = document.getElementById('fecha-hasta');

  if (!checkinInput || !checkoutInput) {
    console.error('Campos de fecha no encontrados');
    return;
  }

  [checkinInput, checkoutInput].forEach(input => {
    input.addEventListener('blur', function(event) {
      event.preventDefault();
      if (!event.target.value) {
        const fieldName = event.target.id === 'fecha-desde' ? 'Desde fecha' : 'Hasta fecha';
        mensajeError(`Por favor, ingrese una fecha vÃ¡lida en "${fieldName}".`);
        event.target.focus();
      }
    });
  });
}


if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', inicializarValidacionesCampos);
} else {
  inicializarValidacionesCampos();
}


