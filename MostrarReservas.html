<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hotel Premier</title>
  <link rel="stylesheet" href="css/MostrarReservas.css"/>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
  />
</head>
<body>
  <a href="javascript:history.back()" style="position: absolute; bottom: 20px; left: 20px; text-decoration: none; font-size: 24px; color: #64443a; z-index: 2;">&#8592; Volver</a>
  <div class="background">
    <div class="booking-form">
      <h2 style="text-align: center;">Habitaciones Disponibles</h2>
      <form novalidate>
        <label for="checkin">Desde fecha</label>
        <input type="date" id="checkin" name="checkin" required>

        <label for="checkout">Hasta fecha</label>
        <input type="date" id="checkout" name="checkout" required>
        <button type="submit">Buscar</button>
      </form>
    </div>
    
  </div>
  <div class="resultado animate__animated animate__fadeIn" style="display: none;">
    <img src="assets/image/Pregunta.png" alt="" style="position: absolute; top: 5px; right: 15px; width: 50px; height: 50px;" class="iconoInformacion">
    <h2>Resultados de la búsqueda</h2>
    <!-- <div class="leyenda">
      <h3>Estados:</h3>
      <div class="leyenda-item"><div class="color-box color-libre"></div> Libre</div>
      <div class="leyenda-item"><div class="color-box color-ocupada"></div> Ocupada</div>
      <div class="leyenda-item"><div class="color-box color-reservada"></div> Reservada</div>
      <div class="leyenda-item"><div class="color-box color-fuera-servicio"></div> Fuera de Servicio</div>
    </div> -->
    <div class="tabla-scroll" style="position: relative;">
      <table>
        <thead>
          <tr>
            <th>Fecha \ Habitación</th>
            <th>IND-101</th>
            <th>IND-102</th>
            <th>DOB-201</th>
            <th>DOB-202</th>
            <th>SUITE-301</th>
            <th>SUITE-303</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>25/04/2025</td>
            <td class="libre"></td>
            <td class="reservada"></td>
            <td class="ocupada"></td>
            <td class="libre"></td>
            <td class="reservada"></td>
            <td class="ocupada"></td>
          </tr>
          <tr>
            <td>26/04/2025</td>
            <td class="ocupada"></td>
            <td class="reservada"></td>
            <td class="ocupada"></td>
            <td class="ocupada"></td>
            <td class="reservada"></td>
            <td class="ocupada"></td>
          </tr>
          <tr>
            <td>27/04/2025</td>
            <td class="ocupada"></td>
            <td class="libre"></td>
            <td class="libre"></td>
            <td class="ocupada"></td>
            <td class="libre"></td>
            <td class="libre"></td>
          </tr>
          <tr>
            <td>28/04/2025</td>
            <td class="libre"></td>
            <td class="libre"></td>
            <td class="libre"></td>
            <td class="libre"></td>
            <td class="libre"></td>
            <td class="libre"></td>
          </tr>
          <tr>
            <td>29/04/2025</td>
            <td class="libre"></td>
            <td class="libre"></td>
            <td class="libre"></td>
            <td class="libre"></td>
            <td class="libre"></td>
            <td class="libre"></td>
          </tr>
          <tr>
            <td>30/04/2025</td>
            <td class="fuera-servicio"></td>
            <td class="libre"></td>
            <td class="libre"></td>
            <td class="fuera-servicio"></td>
            <td class="libre"></td>
            <td class="libre"></td>
          </tr>
          <tr>
            <td>31/04/2025</td>
            <td class="fuera-servicio"></td>
            <td class="libre"></td>
            <td class="libre"></td>
            <td class="fuera-servicio"></td>
            <td class="libre"></td>
            <td class="libre"></td>
          </tr>
          <tr>
            <td>01/05/2025</td>
            <td class="fuera-servicio"></td>
            <td class="libre"></td>
            <td class="libre"></td>
            <td class="fuera-servicio"></td>
            <td class="libre"></td>
            <td class="libre"></td>
          </tr>
          <tr>
            <td>02/05/2025</td>
            <td class="fuera-servicio"></td>
            <td class="libre"></td>
            <td class="libre"></td>
            <td class="fuera-servicio"></td>
            <td class="libre"></td>
            <td class="libre"></td>
          </tr>
          <tr>
            <td>03/05/2025</td>
            <td class="fuera-servicio"></td>
            <td class="libre"></td>
            <td class="libre"></td>
            <td class="fuera-servicio"></td>
            <td class="libre"></td>
            <td class="libre"></td>
          </tr>
        </tbody>
      </table>
      
    </div>
    <div class="siguiente">Reservar</div>
  </div>
  
  <div id="modal" class="modal" style="display: none;">
    <div class="modal-content error">
      <h2 style="text-align: center; color: #d32f2f; font-size: 24px; margin-top: 10px;">ERROR</h2>
      <img src="assets/image/Error.png" alt="icono de error" style="height: 30%; display: block; margin: 0 auto;">
      <p id="error-message" style="text-align: center; margin-top: 20px;">Por favor, completa todos los campos requeridos.</p>
      <button id="ok-button" style="display: block; margin: 20px auto 0; padding: 10px 20px; background-color: #d32f2f; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;" class="boton">OK</button>
    </div>
  </div>
  <div id="modalCorrecto" class="modal" style="display: none;">
    <div class="modal-content correcto">
      <h2 style="text-align: center; color: #2fd345; font-size: 24px; margin-top: 10px;">EXITO</h2>
      <img src="assets/image/Correcto.png" alt="icono de error" style="height: 30%; display: block; margin: 0 auto;">
      <p id="error-messageCorrecto" style="text-align: center; margin-top: 20px;">Accion ejecutada con exito</p>
    </div>
  </div>
  <div id="modalAdvertencia" class="modal" style="display: none;">
    <div class="modal-content advertencia">
      <h2 style="text-align: center; color: #00e1f0; font-size: 24px; margin-top: 10px;">ADVERTENCIA</h2>
      <img src="assets/image/Advertencia.png" alt="icono de error" style="height: 30%; display: block; margin: 0 auto;">
      <p id="error-messageAdvertencia" style="text-align: center; margin-top: 20px;">El numero de documento ya existe</p>
      <div class="advertenciaBotones" style="display: flex; justify-content: center; align-items: center; margin-bottom: 20px;">
        <button id="AdvertenciaBoton1" style="display: block; margin: 20px auto 0; padding: 10px 20px; background-color: #d32f2f; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;" class="boton">ACEPTAR</button>
        <button id="AdvertenciaBoton2" style="display: block; margin: 20px auto 0; padding: 10px 20px; background-color: #2fd345; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;" class="boton">CORREGIR</button>
      </div>
    </div>
  </div>
  <script>
    function mensajeError(mensaje) {
      const modal = document.getElementById('modal');
      const errorMessage = document.getElementById('error-message');
      
      errorMessage.textContent = mensaje;
      
      modal.style.display = "flex";
      
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }

      const okButton = document.getElementById('ok-button');
      okButton.onclick = function() {
        modal.style.display = "none";
      };
    }

    const checkinInput = document.getElementById('checkin');
    const checkoutInput = document.getElementById('checkout');

    [checkinInput, checkoutInput].forEach(input => {
      input.addEventListener('blur', function(event) {
      event.preventDefault();
      if (!event.target.value) {
        const fieldName = event.target.id === 'checkin' ? 'Desde fecha' : 'Hasta fecha';
        mensajeError(`Por favor, ingrese una fecha válida en "${fieldName}".`);
        event.target.focus();
      }
      
      });
    });

    const form = document.querySelector('form');
    form.addEventListener('submit', function(event) {
      event.preventDefault(); 
      const checkinInput = document.getElementById('checkin');
      const checkoutInput = document.getElementById('checkout');

      if (!checkinInput.value) {
        mensajeError('Por favor, ingrese una fecha válida en "Desde fecha".');
        checkinInput.focus();
        return;
      }

      if (!checkoutInput.value) {
        mensajeError('Por favor, ingrese una fecha válida en "Hasta fecha".');
        checkoutInput.focus();
        return;
      }

      if (new Date(checkinInput.value) >= new Date(checkoutInput.value)) {
        mensajeError('La fecha de salida debe ser posterior a la fecha de entrada.');
        checkinInput.value = '';
        checkoutInput.value = '';
        checkinInput.focus();
        return;
      }
      document.body.classList.add('opaco');
      const resultadoDiv = document.querySelector('.resultado');
      resultadoDiv.style.display = 'block';
    });
      
    function aplicarEstilosCeldas() {
      const celdas = document.querySelectorAll('td');
      celdas.forEach(celda => {
      switch (celda.textContent.trim().toLowerCase()) {
        case 'libre':
        celda.style.backgroundColor = '#c3e6cb';
        celda.style.color = '#155724';
        break;
        case 'ocupada':
        celda.style.backgroundColor = '#f5c6cb';
        celda.style.color = '#721c24';
        break;
        case 'reservada':
        celda.style.backgroundColor = '#ffeeba';
        celda.style.color = '#856404';
        break;
        case 'fuera de servicio':
        celda.style.backgroundColor = '#c6c8ca';
        celda.style.color = '#383d41';
        break;
      }
      });
    }

    document.addEventListener('DOMContentLoaded', aplicarEstilosCeldas);
    function obtenerCeldasColumna(index) {
      const filas = document.querySelectorAll('tbody tr');
      const celdasColumna = [];
      filas.forEach(fila => {
      const celda = fila.cells[index];
      if (celda) {
        celdasColumna.push(celda);
      }
      });
      return celdasColumna;
    }
    let habitacionesSeleccionadas = [];
    document.querySelectorAll('th').forEach((header, index) => {
      header.addEventListener('click', () => {
        
        const celdasColumna = obtenerCeldasColumna(index);
        const todasLibres = celdasColumna.every(celda => celda.textContent.trim().toLowerCase() === 'libre');
        if (!todasLibres) {
          mensajeError("No se puede cambiar el estado de la habitacion porque no todos los horarios estan libres");
          return;
        }
        const habitacion = header.textContent.trim();
        let index2 = habitacionesSeleccionadas.indexOf(habitacion);
        if (index2 === -1) {
          habitacionesSeleccionadas.push(habitacion);
        } else {
          habitacionesSeleccionadas.splice(index2, 1);
        }
        celdasColumna.forEach(celda => {
          if(celda.style.backgroundColor == 'yellow'){
            switch (celda.textContent.trim().toLowerCase()) {
                case 'libre':
                celda.style.backgroundColor = '#c3e6cb';
                celda.style.color = '#155724';
                break;
                case 'ocupada':
                celda.style.backgroundColor = '#f5c6cb';
                celda.style.color = '#721c24';
                break;
                case 'reservada':
                celda.style.backgroundColor = '#ffeeba';
                celda.style.color = '#856404';
                break;
                case 'fuera de servicio':
                celda.style.backgroundColor = '#c6c8ca';
                celda.style.color = '#383d41';
                break;
              }
          }
          else{
            celda.style.backgroundColor = 'yellow';
            celda.style.color = 'black';
          }
        });
      });
    });

    const siguienteButton = document.querySelector('.siguiente');
    siguienteButton.addEventListener('click', function() {
        if (habitacionesSeleccionadas.length === 0) {
            mensajeError("Por favor, seleccione al menos una habitación.");
            return;
        }
        const desdeFecha = checkinInput.value;
        const hastaFecha = checkoutInput.value;
        
        const fechaSeleccionada1 = new Date(desdeFecha);
        const fechaSeleccionada2 = new Date(hastaFecha);

        const dias = ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado','Domingo' ];
        const diaSemanaImput1 = dias[fechaSeleccionada1.getDay()];
        const diaSemanaImput2 = dias[fechaSeleccionada2.getDay()];
        
        const titulo = "Horarios por reservar:"
        const resultadoDiv = document.querySelector('.resultado');
        const resultadoCopia = resultadoDiv.cloneNode(true);
        resultadoDiv.style.display = 'none';
        document.body.appendChild(resultadoCopia);

        resultadoCopia.querySelector('.tabla-scroll').remove();
        resultadoCopia.querySelector('.siguiente').remove();
        resultadoCopia.querySelector('h2').textContent = `${titulo}`;

        resultadoCopia.style.display = 'block';
        const nuevoSiguienteButton = siguienteButton.cloneNode(true);
        nuevoSiguienteButton.textContent = "Aceptar";
        const nuevoCancelarButton = siguienteButton.cloneNode(true);
        nuevoCancelarButton.textContent = "Rechazar";
        nuevoCancelarButton.addEventListener('click', function() {
            resultadoCopia.remove();
            aplicarEstilosCeldas();
            habitacionesSeleccionadas = [];
            document.body.classList.remove('opaco');
        });
        nuevoSiguienteButton.addEventListener('click', function() {
            console.log("hice click aca");
            resultadoCopia.innerHTML = '';
            resultadoCopia.style.display = 'flex';
            resultadoCopia.style.flexDirection = 'column';
            resultadoCopia.style.alignItems = 'center';
            // resultadoCopia.style.justifyContent = 'center';
            const nuevoTitulo = document.createElement('h2');
            nuevoTitulo.textContent = "Datos del huesped";
            resultadoCopia.appendChild(nuevoTitulo);
            const formularioHuesped = document.createElement('form');
            formularioHuesped.style.width = '100%';
            formularioHuesped.innerHTML = `
              <div style="text-align: center;width:100%;">
              <label class="required" for="nombre" style="display: block; margin-bottom: 5px;">Nombre:</label>
              <input type="text" id="nombre" name="nombre" required style="width: 50%; padding: 8px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px;">
              
              <label class="required" for="apellido" style="display: block; margin-bottom: 5px;">Apellido:</label>
              <input type="text" id="apellido" name="apellido" required style="width: 50%; padding: 8px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px;">
              
              <label class="required" for="telefono" style="display: block; margin-bottom: 5px;">Teléfono:</label>
              <input type="tel" id="telefono" name="telefono" required style="width: 50%; padding: 8px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px;">
              </div>
            `;
            const confirmarButton = document.createElement('button');
            confirmarButton.type = "submit";
            confirmarButton.textContent = "Enviar";
            confirmarButton.style.cssText = "background-color: #6d4c41; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; position: absolute; bottom: 15px;";
            confirmarButton.addEventListener('click', function(event) {
                event.preventDefault();
                const nombre = document.getElementById('nombre').value;
                const apellido = document.getElementById('apellido').value;
                const telefono = document.getElementById('telefono').value;
                const inputs = [document.getElementById('nombre'), document.getElementById('apellido'), document.getElementById('telefono')];
                inputs.forEach(input => {
                  if (!input.value) {
                  input.style.border = '2px solid red';
                  } else {
                  input.style.border = '1px solid #ccc';
                  }
                });
                if (inputs.some(input => !input.value)) {
                  mensajeError("Por favor, complete todos los campos requeridos.");
                  return;
                }
                mensajeCorrecto(`Reserva realizada con éxito para <br>"${nombre} ${apellido}".<br>Presione cualquier tecla para continuar.`);
                document.addEventListener('keydown', function() {
                  resultadoCopia.remove();
                  aplicarEstilosCeldas();
                  habitacionesSeleccionadas = [];
                  document.body.classList.remove('opaco');
                });
                
                
            });
            resultadoCopia.appendChild(confirmarButton);
            
            resultadoCopia.appendChild(formularioHuesped);
        });
        resultadoCopia.appendChild(nuevoCancelarButton);
        resultadoCopia.appendChild(nuevoSiguienteButton);

        habitacionesSeleccionadas.forEach((habitacion) => {
            const habitacionDiv = document.createElement('div');
            habitacionDiv.style.textAlign = 'center';
            habitacionDiv.style.border = '2px solid black';
            habitacionDiv.style.padding = '10px';
            habitacionDiv.innerHTML = `
          <p>Habitación: <strong>${habitacion}</strong></p>
          <p>Desde fecha: <strong>${diaSemanaImput1}, ${desdeFecha}</strong></p>
          <p>Hasta fecha: <strong>${diaSemanaImput2}, ${hastaFecha}</strong></p>
            `;
            resultadoCopia.insertBefore(habitacionDiv, nuevoCancelarButton);
        });
        nuevoSiguienteButton.style.position = 'absolute';
        nuevoSiguienteButton.style.left = 'calc(70% - 20px)';
        nuevoSiguienteButton.style.bottom = '0';
        nuevoCancelarButton.style.position = 'absolute';
        nuevoCancelarButton.style.left = 'calc(70% - 20px - 30% - 10px)';
        nuevoCancelarButton.style.bottom = '0';
        const buscarButton = document.querySelector('button[type="submit"]');
        buscarButton.addEventListener('click', function() {
            resultadoCopia.remove();
            resultadoDiv.style.display = 'block';
            aplicarEstilosCeldas();
            habitacionesSeleccionadas = [];
        });
    });

    function mensajeCorrecto(mensaje) {
      if (mensaje == undefined) mensaje = "Acción ejecutada con éxito";
      
      const modal = document.getElementById('modalCorrecto');
      const successMessage = document.getElementById('error-messageCorrecto');
      
      successMessage.innerHTML = mensaje;
      
      modal.style.display = "flex";
      window.onkeydown = function() {
        modal.style.display = "none";
      };

    }

    const iconoInformacion = document.querySelector('.iconoInformacion');
    iconoInformacion.addEventListener('click', function() {
        const resultado = document.querySelector('.resultado');
        const hijosCopia = Array.from(resultado.children).map(child => child.cloneNode(true));
        while (resultado.firstChild) {
          resultado.removeChild(resultado.firstChild);
        }
        const leyendaDiv = document.createElement('div');
        leyendaDiv.className = 'leyenda';
        leyendaDiv.innerHTML = `
            <span class="iconoCerrar" style="position: absolute; top: 5px; right: 15px; width: 40px; height: 40px; font-size: 36px; color: #64443a; cursor: pointer; z-index: 10; display: flex; align-items: center; justify-content: center;">&times;</span>
          <fieldset style="padding:20px; border-radius:10px"><h3 style="">Estados de habitaciones:</h3>
          <div class="leyenda-item"><div class="color-box color-libre"></div> Libre</div>
          <div class="leyenda-item"><div class="color-box color-ocupada"></div> Ocupada</div>
          <div class="leyenda-item"><div class="color-box color-reservada"></div> Reservada</div>
          <div class="leyenda-item"><div class="color-box color-fuera-servicio"></div> Fuera de Servicio</div></fieldset>
          <fieldset style="padding:20px; border-radius:10px"><h3 style="">Nomenclatura: Tipo Habitacion - Numero Habitacion</h3>
            <p class="tipoHabitacion"><span style="font-size: 18px; margin-right: 5px;">&#8594;</span>IND: Individual</p>
          <p class="tipoHabitacion"><span style="font-size: 18px; margin-right: 5px;">&#8594;</span>DOB: Doble</p>
          <p class="tipoHabitacion"><span style="font-size: 18px; margin-right: 5px;">&#8594;</span>SUITE: Suite</p></fieldset>
          <fieldset style="padding:20px; border-radius:10px"><h3 style="">Seleccionar Habitacion</h3>
          <p><span style="display:inline-block;width:12px;height:12px;background:rgb(255, 72, 72); border:2px solid black; border-radius:50%;margin-right:6px;vertical-align:middle;"></span>Para seleccionar una habitación, haga clic en el encabezado de la columna correspondiente. Las habitaciones seleccionadas se resaltarán en amarillo.</p></fieldset>
        `;
        resultado.appendChild(leyendaDiv);
        iconoCerrar = leyendaDiv.querySelector('.iconoCerrar');
        iconoCerrar.addEventListener('click', function() {
          resultado.innerHTML = '';
          hijosCopia.forEach(child => resultado.appendChild(child));
          
        });
    });

        
       
  </script>
  <script src="JS/general.js"></script>

</body>
</html>
